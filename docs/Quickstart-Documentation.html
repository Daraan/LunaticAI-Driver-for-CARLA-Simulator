<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        My first HackMD note (change me!) - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{border-radius:3px;font-size:85%;line-height:1.45;overflow:auto}.markdown-body:not(.next-editor) pre{padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-alert{border-left-style:solid;border-left-width:4px;color:inherit;margin-bottom:16px;padding:8px 16px}.markdown-alert .markdown-alert-title{align-items:center;display:flex;font-weight:500;line-height:1;white-space:break-spaces}.markdown-body .markdown-alert>*{margin-bottom:0;margin-top:16px}.markdown-body .markdown-alert .selection-popover,.markdown-body .markdown-alert>:first-child{margin-top:0}.markdown-alert.markdown-alert-note{border-left-color:#0969da}.markdown-alert.markdown-alert-note .markdown-alert-title{fill:currentColor;color:#0969da}.markdown-alert.markdown-alert-tip{border-left-color:#1a7f37}.markdown-alert.markdown-alert-tip .markdown-alert-title{fill:currentColor;color:#1a7f37}.markdown-alert.markdown-alert-important{border-left-color:#8250df}.markdown-alert.markdown-alert-important .markdown-alert-title{fill:currentColor;color:#8250df}.markdown-alert.markdown-alert-warning{border-left-color:#9a6700}.markdown-alert.markdown-alert-warning .markdown-alert-title{fill:currentColor;color:#9a6700}.markdown-alert.markdown-alert-caution{border-left-color:#d1242f}.markdown-alert.markdown-alert-caution .markdown-alert-title{fill:currentColor;color:#d1242f}:root[theme=dark] :not([theme])>*>.markdown-body,:root[theme] [theme=dark] .markdown-body{color:#f4f4f5}:root[theme=dark] :not([theme])>*>.markdown-body h1,:root[theme=dark] :not([theme])>*>.markdown-body h2,:root[theme] [theme=dark] .markdown-body h1,:root[theme] [theme=dark] .markdown-body h2{border-bottom-color:#52525b}:root[theme=dark] :not([theme])>*>.markdown-body h6,:root[theme] [theme=dark] .markdown-body h6{color:#a1a1aa}:root[theme=dark] :not([theme])>*>.markdown-body details,:root[theme] [theme=dark] .markdown-body details{background-color:#303036;color:#f4f4f5}:root[theme=dark] :not([theme])>*>.markdown-body details summary::marker:first-child,:root[theme] [theme=dark] .markdown-body details summary::marker:first-child{color:#f4f4f5}:root[theme=dark] :not([theme])>*>.markdown-body details:hover,:root[theme] [theme=dark] .markdown-body details:hover{background:#303036}:root[theme=dark] :not([theme])>*>.markdown-body details code,:root[theme=dark] :not([theme])>*>.markdown-body details[open]:hover,:root[theme] [theme=dark] .markdown-body details code,:root[theme] [theme=dark] .markdown-body details[open]:hover{background-color:#303036}:root[theme=dark] :not([theme])>*>.markdown-body hr,:root[theme] [theme=dark] .markdown-body hr{background-color:#52525b}:root[theme=dark] :not([theme])>*>.markdown-body blockquote,:root[theme] [theme=dark] .markdown-body blockquote{border-left-color:#71717a;color:#a1a1aa}:root[theme=dark] :not([theme])>*>.markdown-body blockquote a span,:root[theme] [theme=dark] .markdown-body blockquote a span{color:#9894f9}:root[theme=dark] :not([theme])>*>.markdown-body a.mention-anchor.user-card-popover,:root[theme] [theme=dark] .markdown-body a.mention-anchor.user-card-popover{background-color:#453aff26;color:#9894f9}:root[theme=dark] :not([theme])>*>.markdown-body ::selection,:root[theme] [theme=dark] .markdown-body ::selection{background-color:#453aff99}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-info,:root[theme] [theme=dark] .markdown-body .alert.alert-info{background-color:#38bdf81a;border-left-color:#0ea5e9;color:#38bdf8}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-info code,:root[theme] [theme=dark] .markdown-body .alert.alert-info code{background-color:#0c4a6e}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-warning,:root[theme] [theme=dark] .markdown-body .alert.alert-warning{background-color:#fbbf241a;border-left-color:#f59e0b;color:#f59e0b}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-warning code,:root[theme] [theme=dark] .markdown-body .alert.alert-warning code{background-color:#78350f}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-success,:root[theme] [theme=dark] .markdown-body .alert.alert-success{background-color:#6db19d26;border-left-color:#55b685;color:#6db19d}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-success code,:root[theme] [theme=dark] .markdown-body .alert.alert-success code{background-color:#214d3c}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-danger,:root[theme] [theme=dark] .markdown-body .alert.alert-danger{background-color:#ef444433;border-left-color:#ef4444;color:#f87171}:root[theme=dark] :not([theme])>*>.markdown-body .alert.alert-danger code,:root[theme] [theme=dark] .markdown-body .alert.alert-danger code{background-color:#7f1d1d}:root[theme=dark] :not([theme])>*>.markdown-body .mark,:root[theme=dark] :not([theme])>*>.markdown-body mark,:root[theme] [theme=dark] .markdown-body .mark,:root[theme] [theme=dark] .markdown-body mark{background-color:#fbbf241a;color:#f59e0b}:root[theme=dark] :not([theme])>*>.markdown-body .mark span,:root[theme=dark] :not([theme])>*>.markdown-body mark span,:root[theme] [theme=dark] .markdown-body .mark span,:root[theme] [theme=dark] .markdown-body mark span{color:#fbbf24}:root[theme=dark] :not([theme])>*>.markdown-body .highlight pre,:root[theme=dark] :not([theme])>*>.markdown-body pre,:root[theme] [theme=dark] .markdown-body .highlight pre,:root[theme] [theme=dark] .markdown-body pre{background-color:#303036;color:#a1a1aa}:root[theme=dark] :not([theme])>*>.markdown-body .style .token.string,:root[theme=dark] :not([theme])>*>.markdown-body .token.entity,:root[theme=dark] :not([theme])>*>.markdown-body .token.operator,:root[theme=dark] :not([theme])>*>.markdown-body .token.url,:root[theme=dark] :not([theme])>*>.markdown-body.language-css,:root[theme=dark] :not([theme])>*>.markdown-body.token.string,:root[theme] [theme=dark] .markdown-body .style .token.string,:root[theme] [theme=dark] .markdown-body .token.entity,:root[theme] [theme=dark] .markdown-body .token.operator,:root[theme] [theme=dark] .markdown-body .token.url,:root[theme] [theme=dark] .markdown-body.language-css,:root[theme] [theme=dark] .markdown-body.token.string{background:none}:root[theme=dark] :not([theme])>*>.markdown-body :not(pre)>code,:root[theme] [theme=dark] .markdown-body :not(pre)>code{background-color:#3f3f46}:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-tag,:root[theme] [theme=dark] .markdown-body code .hljs-tag{color:#d4d4d8}:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-keyword,:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-selector-tag,:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-type,:root[theme=dark] :not([theme])>*>.markdown-body code .token.boolean,:root[theme=dark] :not([theme])>*>.markdown-body code .token.constant,:root[theme=dark] :not([theme])>*>.markdown-body code .token.deleted,:root[theme=dark] :not([theme])>*>.markdown-body code .token.number,:root[theme=dark] :not([theme])>*>.markdown-body code .token.property,:root[theme=dark] :not([theme])>*>.markdown-body code .token.symbol,:root[theme=dark] :not([theme])>*>.markdown-body code .token.tag,:root[theme] [theme=dark] .markdown-body code .hljs-keyword,:root[theme] [theme=dark] .markdown-body code .hljs-selector-tag,:root[theme] [theme=dark] .markdown-body code .hljs-type,:root[theme] [theme=dark] .markdown-body code .token.boolean,:root[theme] [theme=dark] .markdown-body code .token.constant,:root[theme] [theme=dark] .markdown-body code .token.deleted,:root[theme] [theme=dark] .markdown-body code .token.number,:root[theme] [theme=dark] .markdown-body code .token.property,:root[theme] [theme=dark] .markdown-body code .token.symbol,:root[theme] [theme=dark] .markdown-body code .token.tag{color:#ff70b4}:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-attribute,:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-bullet,:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-literal,:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-number,:root[theme=dark] :not([theme])>*>.markdown-body code .hljs-symbol,:root[theme=dark] :not([theme])>*>.markdown-body code .token.atrule,:root[theme=dark] :not([theme])>*>.markdown-body code .token.attr-value,:root[theme=dark] :not([theme])>*>.markdown-body code .token.keyword,:root[theme] [theme=dark] .markdown-body code .hljs-attribute,:root[theme] [theme=dark] .markdown-body code .hljs-bullet,:root[theme] [theme=dark] .markdown-body code .hljs-literal,:root[theme] [theme=dark] .markdown-body code .hljs-number,:root[theme] [theme=dark] .markdown-body code .hljs-symbol,:root[theme] [theme=dark] .markdown-body code .token.atrule,:root[theme] [theme=dark] .markdown-body code .token.attr-value,:root[theme] [theme=dark] .markdown-body code .token.keyword{color:#9894f9}:root[theme=dark] :not([theme])>*>.markdown-body pre.part.plugin-rendered,:root[theme] [theme=dark] .markdown-body pre.part.plugin-rendered{background-color:#fff;color:#000}:root[theme=dark] :not([theme])>*>.markdown-body table,:root[theme] [theme=dark] .markdown-body table{border-color:#52525b}:root[theme=dark] :not([theme])>*>.markdown-body table thead tr,:root[theme] [theme=dark] .markdown-body table thead tr{background-color:#303036;border-bottom-color:#52525b}:root[theme=dark] :not([theme])>*>.markdown-body table td,:root[theme=dark] :not([theme])>*>.markdown-body table th,:root[theme] [theme=dark] .markdown-body table td,:root[theme] [theme=dark] .markdown-body table th{border-left-color:#52525b;border-top-color:#52525b}:root[theme=dark] :not([theme])>*>.markdown-body table tbody tr,:root[theme=dark] :not([theme])>*>.markdown-body table tr:nth-child(2n),:root[theme] [theme=dark] .markdown-body table tbody tr,:root[theme] [theme=dark] .markdown-body table tr:nth-child(2n){background-color:#27272a}:root[theme=light] :not([theme])>*>.markdown-body,:root[theme] [theme=light] .markdown-body{color:#3f3f46}:root[theme=light] :not([theme])>*>.markdown-body h1,:root[theme=light] :not([theme])>*>.markdown-body h2,:root[theme] [theme=light] .markdown-body h1,:root[theme] [theme=light] .markdown-body h2{border-bottom-color:#e4e4e7}:root[theme=light] :not([theme])>*>.markdown-body h6,:root[theme] [theme=light] .markdown-body h6{color:#71717a}:root[theme=light] :not([theme])>*>.markdown-body iframe,:root[theme=light] :not([theme])>*>.markdown-body img:not(.emoji),:root[theme] [theme=light] .markdown-body iframe,:root[theme] [theme=light] .markdown-body img:not(.emoji){border:1px solid #e4e4e7}:root[theme=light] :not([theme])>*>.markdown-body details,:root[theme] [theme=light] .markdown-body details{background-color:#f4f4f5}:root[theme=light] :not([theme])>*>.markdown-body details:hover,:root[theme] [theme=light] .markdown-body details:hover{background:#e4e4e7}:root[theme=light] :not([theme])>*>.markdown-body details[open]:hover,:root[theme] [theme=light] .markdown-body details[open]:hover{background-color:#f4f4f5}:root[theme=light] :not([theme])>*>.markdown-body details code,:root[theme] [theme=light] .markdown-body details code{background-color:#e4e4e7}:root[theme=light] :not([theme])>*>.markdown-body hr,:root[theme] [theme=light] .markdown-body hr{background-color:#d4d4d8}:root[theme=light] :not([theme])>*>.markdown-body blockquote,:root[theme] [theme=light] .markdown-body blockquote{border-left-color:#e4e4e7;color:#71717a}:root[theme=light] :not([theme])>*>.markdown-body blockquote a span,:root[theme] [theme=light] .markdown-body blockquote a span{color:#453aff}:root[theme=light] :not([theme])>*>.markdown-body a.mention-anchor.user-card-popover,:root[theme] [theme=light] .markdown-body a.mention-anchor.user-card-popover{background-color:#ecebfe;color:#453aff}:root[theme=light] :not([theme])>*>.markdown-body ::selection,:root[theme] [theme=light] .markdown-body ::selection{background-color:#cccafc}:root[theme=light] :not([theme])>*>.markdown-body .alert.alert-info,:root[theme] [theme=light] .markdown-body .alert.alert-info{background-color:#e0f2fe;border-left-color:#0284c7;color:#0284c7}:root[theme=light] :not([theme])>*>.markdown-body .alert.alert-warning,:root[theme] [theme=light] .markdown-body .alert.alert-warning{background-color:#fef3c799;border-left-color:#f59e0b;color:#f59e0b}:root[theme=light] :not([theme])>*>.markdown-body .alert.alert-success,:root[theme] [theme=light] .markdown-body .alert.alert-success{background-color:#d9f9e5;border-left-color:#43946c;color:#43946c}:root[theme=light] :not([theme])>*>.markdown-body .alert.alert-danger,:root[theme] [theme=light] .markdown-body .alert.alert-danger{background-color:#fee2e299;border-left-color:#ef4444;color:#ef4444}:root[theme=light] :not([theme])>*>.markdown-body .mark,:root[theme=light] :not([theme])>*>.markdown-body mark,:root[theme] [theme=light] .markdown-body .mark,:root[theme] [theme=light] .markdown-body mark{background-color:#fef3c799;color:#f59e0b}:root[theme=light] :not([theme])>*>.markdown-body .mark span,:root[theme=light] :not([theme])>*>.markdown-body mark span,:root[theme] [theme=light] .markdown-body .mark span,:root[theme] [theme=light] .markdown-body mark span{color:#f59e0b}:root[theme=light] :not([theme])>*>.markdown-body .highlight pre,:root[theme=light] :not([theme])>*>.markdown-body pre,:root[theme] [theme=light] .markdown-body .highlight pre,:root[theme] [theme=light] .markdown-body pre{background-color:#f4f4f5}:root[theme=light] :not([theme])>*>.markdown-body pre.part.plugin-rendered,:root[theme] [theme=light] .markdown-body pre.part.plugin-rendered{background-color:inherit;color:inherit}:root[theme=light] :not([theme])>*>.markdown-body :not(pre)>code,:root[theme] [theme=light] .markdown-body :not(pre)>code{background-color:#0000000a}:root[theme=light] :not([theme])>*>.markdown-body table,:root[theme] [theme=light] .markdown-body table{border-color:#e4e4e7}:root[theme=light] :not([theme])>*>.markdown-body table thead tr,:root[theme] [theme=light] .markdown-body table thead tr{background-color:#f4f4f5;border-bottom-color:#d4d4d8}:root[theme=light] :not([theme])>*>.markdown-body table td,:root[theme=light] :not([theme])>*>.markdown-body table th,:root[theme] [theme=light] .markdown-body table td,:root[theme] [theme=light] .markdown-body table th{border-left-color:#e4e4e7;border-top-color:#e4e4e7}:root[theme=light] :not([theme])>*>.markdown-body table tbody tr,:root[theme=light] :not([theme])>*>.markdown-body table tr:nth-child(2n),:root[theme] [theme=light] .markdown-body table tbody tr,:root[theme] [theme=light] .markdown-body table tr:nth-child(2n){background-color:#fdfdfd}.markdown-body{font-family:Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body>*{max-width:100%;overflow:auto}.markdown-body .alert a,.markdown-body a{color:var(--hmd-tw-link-text-default)}.markdown-body .alert a:focus,.markdown-body .alert a:hover,.markdown-body a:focus,.markdown-body a:hover{color:var(--hmd-tw-link-text-hover)}.markdown-body .alert a:hover,.markdown-body a:hover{text-decoration-thickness:2px;text-underline-offset:4px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{font-family:Readex Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-weight:700}.markdown-body h1,.markdown-body h2{border-bottom:1px solid}.markdown-body iframe,.markdown-body img{background-color:initial;border-radius:6px;margin:.5rem 0}.markdown-body iframe{max-width:100%;width:728px}.markdown-body details{border-radius:4px;margin-bottom:.5rem;padding:.5rem 1rem}.markdown-body details:hover{transition:all .1s}.markdown-body details summary+p{margin-top:.5rem}.markdown-body details p:last-child{margin-bottom:0}.markdown-body hr{height:2px}.markdown-body img.emoji{border:none;height:20px;vertical-align:middle;width:20px}.markdown-body li small{color:#a1a1aa}.markdown-body blockquote{border-left:3px solid}.markdown-body blockquote .small,.markdown-body blockquote small,.markdown-body li small{display:initial;font-size:85%}.markdown-body a.mention-anchor:before{content:"";margin-right:0}.markdown-body a.mention-anchor.user-card-popover{border-radius:4px;padding:1px 4px}.markdown-body .alert{border:none;border-radius:4px;margin-top:10px}.markdown-body .alert h2,.markdown-body .alert h3,.markdown-body .alert h4,.markdown-body .alert h5,.markdown-body .alert h6{margin-top:0}.markdown-body .alert h2{border:none}.markdown-body .alert.alert-danger,.markdown-body .alert.alert-info,.markdown-body .alert.alert-success,.markdown-body .alert.alert-warning{border-left:3px solid}.markdown-body .highlight pre,.markdown-body .mark,.markdown-body mark,.markdown-body pre{border-radius:4px}.markdown-body pre.part.abc,.markdown-body pre.part.flow-chart,.markdown-body pre.part.fretboard,.markdown-body pre.part.graphviz,.markdown-body pre.part.mermaid,.markdown-body pre.part.sequence-diagram,.markdown-body pre.part.vega-embed{border-radius:4px;max-width:100%;overflow:auto}.markdown-body table{border:1px solid;border-radius:4px;width:fit-content}.markdown-body table thead tr{border-bottom:1px solid;border-top:none}.markdown-body table tbody tr,.markdown-body table thead tr th{border-top:none}.markdown-body table tbody tr td:first-child,.markdown-body table thead,.markdown-body table thead th:first-child{border-left:none}.markdown-body table td,.markdown-body table th{border:1px solid;border-bottom:none;border-right:none;padding:6px 13px}.markdown-body.next-editor{overflow-x:hidden!important}.markdown-body pre{border:inherit}.markdown-body code{color:inherit}html[lang^=ja] .markdown-body code code,html[lang^=ja] .markdown-body code kbd,html[lang^=ja] .markdown-body code pre{font-family:Source Code Pro,Consolas,monaco,Meiryo,ＭＳ ゴシック,MS Gothic,monospace}html[lang=zh-tw] .markdown-body code code,html[lang=zh-tw] .markdown-body code kbd,html[lang=zh-tw] .markdown-body code pre{font-family:Source Code Pro,Consolas,monaco,Microsoft JhengHei,微軟正黑,monospace}html[lang=zh-cn] .markdown-body code code,html[lang=zh-cn] .markdown-body code kbd,html[lang=zh-cn] .markdown-body code pre{font-family:Source Code Pro,Consolas,monaco,Microsoft YaHei,微软雅黑,monospace}html .markdown-body code[lang^=ja] code,html .markdown-body code[lang^=ja] kbd,html .markdown-body code[lang^=ja] pre{font-family:Source Code Pro,Consolas,monaco,Meiryo,ＭＳ ゴシック,MS Gothic,monospace}html .markdown-body code[lang=zh-tw] code,html .markdown-body code[lang=zh-tw] kbd,html .markdown-body code[lang=zh-tw] pre{font-family:Source Code Pro,Consolas,monaco,Microsoft JhengHei,微軟正黑,monospace}html .markdown-body code[lang=zh-cn] code,html .markdown-body code[lang=zh-cn] kbd,html .markdown-body code[lang=zh-cn] pre{font-family:Source Code Pro,Consolas,monaco,Microsoft YaHei,微软雅黑,monospace}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:2px solid #766df8;box-sizing:initial;color:#a1a1aa;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert{display:flex;flex-direction:column;gap:16px}.markdown-body .alert>*{margin:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body pre.pseudocode{white-space-collapse:collapse}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}:root[theme] .markdown-body ::marker,:root[theme] .markdown-body code{color:var(--hmd-tw-text-default)}:root[theme] .markdown-body h1 .octicon-link,:root[theme] .markdown-body h2 .octicon-link,:root[theme] .markdown-body h3 .octicon-link,:root[theme] .markdown-body h4 .octicon-link,:root[theme] .markdown-body h5 .octicon-link,:root[theme] .markdown-body h6 .octicon-link{color:var(--hmd-tw-text-subtle)}:root[theme] .markdown-body .anchor{left:0;margin-left:0;position:absolute}:root[theme] .markdown-body .gist table{border-color:inherit}:root[theme] .markdown-body .gist table thead tr{background-color:inherit;border-bottom-color:inherit}:root[theme] .markdown-body .gist table td,:root[theme] .markdown-body .gist table th{border-left-color:inherit;border-top-color:inherit}:root[theme] .markdown-body .gist table tbody tr,:root[theme] .markdown-body .gist table tr:nth-child(2n){background-color:inherit}@media (max-width:767px){.markdown-body h1{font-size:1.6em}.markdown-body h2{font-size:1.4em}.markdown-body h3{font-size:1.125em}}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:var(--hmd-tw-text-default);font-size:14px;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.ui-infobar .ui-user-icon.small{height:18px;margin:2px;vertical-align:top;width:18px}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:2px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}:root[theme=light] :not([theme])>*>.ui-toc .ui-toc-label,:root[theme] [theme=light] .ui-toc-label{background-color:#fdfdfd;border-color:#d4d4d8;color:#a1a1aa}:root[theme=light] :not([theme])>*>.ui-toc .ui-toc-label:active,:root[theme=light] :not([theme])>*>.ui-toc .ui-toc-label:hover,:root[theme] [theme=light] .ui-toc-label:active,:root[theme] [theme=light] .ui-toc-label:hover{background-color:#f4f4f5;border-color:#d4d4d8;color:#a1a1aa}:root[theme=dark] :not([theme])>*>.ui-toc .ui-toc-label,:root[theme=dark] :not([theme])>*>.ui-toc .ui-toc-label:active,:root[theme=dark] :not([theme])>*>.ui-toc .ui-toc-label:hover,:root[theme] [theme=dark] .ui-toc-label,:root[theme] [theme=dark] .ui-toc-label:active,:root[theme] [theme=dark] .ui-toc-label:hover{background-color:#303036;border-color:#52525b;color:#a1a1aa}:root[theme=dark] :not([theme])>*>.ui-toc.both-mode .ui-toc-label,:root[theme] [theme=dark] .ui-toc.both-mode .ui-toc-label{background-color:#303036;border-color:#3f3f46;color:#d4d4d8}:root[theme=dark] :not([theme])>*>.ui-toc.both-mode .ui-toc-label:hover,:root[theme] [theme=dark] .ui-toc.both-mode .ui-toc-label:hover{background-color:#52525b}.ui-toc-label{border:1px solid;transition:opacity .2s}.ui-toc .open .ui-toc-label,.ui-toc-label:hover{opacity:1;transition:opacity .2s}.ui-toc-dropdown{letter-spacing:normal;margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown.dropdown-menu{box-shadow:0 3px 15px 0 #00000026}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:var(--hmd-tw-text-subtle);display:block;font-size:12px;font-weight:500;line-height:16px;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-color:var(--hmd-tw-border-bold);border-style:solid;border-width:0 0 0 1px;color:#000;color:var(--hmd-tw-text-emphasize);padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-color:var(--hmd-tw-border-bold);border-style:solid;border-width:0 0 0 2px;color:var(--hmd-tw-text-emphasize);font-weight:600;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-width:0 2px 0 medium;border-left:0;border-color:var(--hmd-tw-border-bold);border-style:solid;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:var(--hmd-tw-text-subtle);display:block;font-size:12px;font-weight:500;line-height:16px;margin-left:10px;margin-top:10px;padding:2px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:var(--hmd-tw-text-primary);text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{cursor:pointer;vertical-align:middle}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{text-decoration:underline}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true"><div style="text-align: center; font-size: 15pt;">
    <h1 id="Lunatic-Driving-AI" data-id="Lunatic-Driving-AI"><a class="anchor hidden-xs" href="#Lunatic-Driving-AI" title="Lunatic-Driving-AI"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span style="font-weight: bold;">Lunatic Driving AI</span></h1>
    <span style="font-style: italic; font-size: 12pt;">Ekshita Shetty ; Matriculation Nr. 1963119,</span> <br>
    <span style="font-style: italic; font-size: 12pt;">Daniel Sperber; Matriculation Nr. 1873222</span> <br>
    <span style="font-weight: bold; font-size: 10pt;">University of Mannheim</span>
</div><hr><h2 id="Table-of-Contents" data-id="Table-of-Contents"><a class="anchor hidden-xs" href="#Table-of-Contents" title="Table-of-Contents"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Table of Contents</span></h2><ol style="padding-left: 2em;">
<li><a href="#Introduction"><span>Introduction</span></a>
<ul>
<li><a href="#Installation"><span>Installation</span></a></li>
<li><a href="#QuickStart"><span>QuickStart</span></a></li>
<li><a href="#External-Setup-Using-the-ScenarioRunner-and-other-Initializations"><span>External Setup</span></a></li>
</ul>
</li>
<li><a href="#Agent-Classes"><span>Agent Classes</span></a>
<ul>
<li><a href="#Creation"><span>Creation</span></a>
<ul>
<li><a href="#LunaticChallenger"><span>LunaticChallenger</span></a></li>
<li><a href="#LunaticAgent"><span>LunaticAgent</span></a></li>
</ul>
</li>
<li><a href="#Workflow"><span>WorkFlow</span></a></li>
<li><a href="#Phases"><span>Phases</span></a></li>
</ul>
</li>
<li><a href="#Rules"><span>Rules</span></a>
<ul>
<li><a href="#Evaluation-Function"><span>ConditionFunction</span></a></li>
<li><a href="#Rule-Classes-and-Features"><span>Rule Classes and Features</span></a></li>
<li><a href="#Creating-New-Rule-Metaclass"><span>Creating New Rule Metaclass</span></a></li>
<li><a href="#Adding-Rules-to-Agent"><span>Adding Rules to Agent</span></a></li>
</ul>
</li>
<li><a href="#Context-Object"><span>Context Object</span></a></li>
<li><a href="#Configuration-and-Hydra-Framework"><span>Configuration and Hydra Framework</span></a>
<ul>
<li><a href="#Launching-Customized-Experiments"><span>Launching Customized Experiments</span></a></li>
<li><a href="#Hydra-Framework"><span>Hydra Framework</span></a></li>
<li><a href="#Config-Hierarchy"><span>Config Hierarchy</span></a>
<ul>
<li><a href="#LaunchConfig"><span>LaunchConfig</span></a></li>
<li><a href="#AgentConfig"><span>AgentConfig</span></a></li>
<li><a href="#Type-checking-and-Type-forcing"><span>Type-checking and Type-forcing</span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Further-Modules"><span>Further Modules</span></a>
<ul>
<li><a href="#GameFramework"><span>GameFramework</span></a></li>
<li><a href="#WorldModel"><span>WorldModel</span></a></li>
<li><a href="#Information-Gathering"><span>Information Gathering</span></a>
<ul>
<li><a href="#CarlaDataProvider"><span>CarlaDataProvider</span></a></li>
<li><a href="#Information-Manager"><span>Information Manager</span></a></li>
<li><a href="#DetectionMatrix"><span>DetectionMatrix</span></a></li>
</ul>
</li>
<li><a href="#Responsibility-Sensitive-Safety-(RSS)"><span>Responsibility Sensitive Safety (RSS)</span></a></li>
</ul>
</li>
<li><a href="#Future-Work"><span>Future Work</span></a></li>
<li><a href="#Appendix"><span>Appendix</span></a></li>
</ol><h1 id="Introduction" data-id="Introduction"><a class="anchor hidden-xs" href="#Introduction" title="Introduction"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Introduction</span></h1><p><span>In recent years, the field of software testing has been revolutionized by significant strides in automation. This technique has become a cornerstone of modern software development practices by streamlining and optimizing the testing process. Traditionally, creating test cases was a manual, labor-intensive task, consuming a large portion of the software development cycle. The advent of automation has drastically reduced human effort, increased speed and consistency, and minimized the risk of missing critical test scenarios. Consequently, automation has not only improved efficiency but also enhanced the overall effectiveness and reliability of testing processes.</span></p><p><span>To facilitate this project, we utilized the CARLA simulator, an open-source platform designed for autonomous driving research. CARLA provides a highly realistic urban environment that allows for complex and varied test scenarios, making it an ideal choice for developing and evaluating our customizable driving AI. By leveraging CARLA, we ensured that our testing environment is both versatile and capable of simulating real-world driving conditions.</span></p><p><span>Despite these advancements, evaluating and comparing different automated testing approaches remained a significant challenge. This project aimed to address this issue by creating a benchmark testing environment designed to evaluate machine-generated test cases and their coverage of the input space.</span></p><p><span>The project develops a customizable driving AI within the CARLA simulator, which serves as a robust platform for benchmarking and evaluating various automated testing methodologies. By providing this standardized framework for evaluation, the project has significantly advanced the field of automated testing, promoting the development of more reliable and efficient testing techniques.</span></p><p><span>The project's source code can be accessed via the </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator" target="_blank" rel="noopener"><span>GitHub repository</span></a><span>, and comprehensive API documentation is available on </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/" target="_blank" rel="noopener"><span>Read the Docs</span></a><span>.</span></p><hr><h2 id="Installation" data-id="Installation"><a class="anchor hidden-xs" href="#Installation" title="Installation"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Installation</span></h2><p><span>Setting up the project involves several key steps to ensure compatibility and functionality. First make sure that you have working CARLA installation, detailed installation steps can be found in the </span><a href="https://carla.readthedocs.io/en/0.9.15/" target="_blank" rel="noopener"><span>CARLA documentation</span></a><span>. </span><strong><span>We recommend a Python 3.10</span></strong><span>, alternatively a Python 3.7 setting.</span></p><p><span>Afterwards, begin by cloning the project repository from GitHub and navigating to the project directory in your terminal:</span></p><ol style="padding-left: 2em;">
<li><span>Clone the repository:</span><pre><code class="sh hljs">​​​​git <span class="hljs-built_in">clone</span> --recurse-submodules https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator.git LunaticAI
​​​​<span class="hljs-built_in">cd</span> LunaticAI
​​​​<span class="hljs-comment"># # Use these two commands if you forgot the --recurse-submodules</span>
​​​​git submodule init 
​​​​git submodule update
</code></pre>
</li>
<li><span>Install dependencies from the requirements file:</span><pre><code class="sh hljs">​​​​pip install -r docs/requirements/requirements.txt
</code></pre>
</li>
</ol><p><span>For a more comprehensive installation process and specific configurations related to using the CARLA simulator, refer to the </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/docs/Install.html" target="_blank" rel="noopener"><span>Lunatic AI Driver installation guide</span></a><span>. This guide provides detailed instructions on setting up the necessary components to integrate the LunaticAI Driver with CARLA. Ensure all environment variables and dependencies are correctly configured as outlined in the guide to proceed effectively with the installation.</span></p><hr><h2 id="Quickstart" data-id="Quickstart"><a class="anchor hidden-xs" href="#Quickstart" title="Quickstart"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Quickstart</span></h2><p><span>To quickly start using the project with the LunaticAI Driver for CARLA simulator, follow these initial steps:</span></p><ol style="padding-left: 2em;">
<li>
<p><span>Begin by launching the CARLA simulator environment. Ensure it is properly configured and running on your system.</span></p>
</li>
<li>
<p><span>Next, navigate to the project directory where you have cloned the repository. Use the provided scripts and configurations to initiate the driving AI within CARLA. For a quickstart run this minimal setup script:</span></p>
<pre><code class="shell hljs">​​​​python examples/minimal.py
</code></pre>
<p><span>Alternatively you can construct a minimal example in the following way:</span></p>
<pre><code class="python hljs">​​​​<span class="hljs-keyword">from</span> agents.lunatic_agent <span class="hljs-keyword">import</span> LunaticAgent
​​​​<span class="hljs-keyword">from</span> classes.worldmodel <span class="hljs-keyword">import</span> GameFramework

​​​​<span class="hljs-comment"># Sets up Carla and Pygame, and Hydra in a limited way</span>
​​​​game_framework = GameFramework.quickstart()

​​​​ego = GameFramework.request_new_actor(<span class="hljs-string">"car"</span>, rolename=<span class="hljs-string">"hero"</span>, random_location=<span class="hljs-literal">True</span>)

​​​​<span class="hljs-comment"># Create a lunatic agent</span>
​​​​agent = LunaticAgent(game_framework.agent_config, vehicle=ego)

​​​​<span class="hljs-keyword">try</span>:
​​​​    <span class="hljs-keyword">while</span> game_framework.continue_loop:
​​​​        <span class="hljs-keyword">with</span> game_framework(agent):
​​​​            agent.run_step()
​​​​            <span class="hljs-comment"># Use the mouse to override the agents controls; use ESC to quit</span>
​​​​            <span class="hljs-keyword">if</span> game_framework.controller.parse_events(agent.get_control()):
​​​​                <span class="hljs-keyword">break</span>
​​​​            agent.apply_control()
​​​​<span class="hljs-keyword">except</span>:
​​​​    <span class="hljs-comment"># Destroy spawned actors</span>
​​​​    game_framework.cleanup()
​​​​    <span class="hljs-keyword">raise</span>
</code></pre>
<div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> Note that this setup omits some steps and does not provide access too all features. Look into </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/blob/main/AgentGameLoop.py" target="_blank" rel="noopener"><span>AgentGameLoop.py</span></a><span> for a comprehensive setup.</span></p>
</div>
<ol start="3" style="padding-left: 2em;">
<li><span>Alternatively you can use the provided </span><code>run_leaderboard_agent.sh</code><span> script to test the </span><code>LunaticChallenger</code><span>.</span>
<div class="alert alert-warning">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> The default route (Town10HD) is loaded faster, however its speed is sometimes worse than the big Town12 that takes longer to load.</span><br>
<span>Consider turning off </span><code>ENABLE_DATA_MATRIX</code><span> or </span><code>ENABLE_RSS</code><span> to gain performance.</span></p>
</div>
</li>
</ol>
</li>
</ol><p><span>Additionally, for controlling the driving AI during simulation, you can utilize the hotkeys implemented using Pygame. In-game, you can press the 'H' key to view the controls or refer to the full list of keyboard controls the </span><a href="#Keyboard-Controls"><span>Appendix</span></a><span>.</span></p><hr><h2 id="External-Setup-Using-the-ScenarioRunner-and-other-Initializations" data-id="External-Setup-Using-the-ScenarioRunner-and-other-Initializations"><a class="anchor hidden-xs" href="#External-Setup-Using-the-ScenarioRunner-and-other-Initializations" title="External-Setup-Using-the-ScenarioRunner-and-other-Initializations"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>External Setup: Using the ScenarioRunner and other Initializations</span></h2><p><span>During the agents creation the script waits until an external actor is found, by default named </span><code>hero</code><span>. This allows the </span><code>LunaticAgent</code><span> to be used with other scripts that set up the scenario and spawn this special actor. To initialize a route the agent should follow call:</span></p><pre><code class="wrap python hljs"><span class="hljs-comment"># CARLA's BasicAgent interface</span>
<span class="hljs-comment"># plan: list of [carla.Waypoint, RoadOption] representing the route to be followed</span>
lunatic_agent.set_global_plan(plan, clean_queue=<span class="hljs-literal">True</span>):

<span class="hljs-comment"># leaderboard AutonomousAgent interface</span>
<span class="hljs-comment"># global_plan_gps: "tuple[Dict[str, float], RoadOption]"</span>
<span class="hljs-comment"># global_plan_world_coord: "tuple[carla.Transform, RoadOption]"</span>
lunatic_challenger.set_global_plan(global_plan_gps, global_plan_world_coord)
</code></pre><div class="alert alert-danger">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> For performance and interface reasons the LunaticAgent uses the </span><a href="https://github.com/carla-simulator/scenario_runner/blob/master/srunner/scenariomanager/carla_data_provider.py" target="_blank" rel="noopener"><code>CarlaDataProvider</code></a><span> from the </span><a href="https://github.com/carla-simulator/scenario_runner" target="_blank" rel="noopener"><span>scenario runner</span></a><span> as a backbone to access global information.</span></p>
<p><strong><span>To detect actors, all actors must be spawned over the CarlaDataProvider and the LunaticAgent must have access to the same CarlaDataProvider object</span></strong></p>
</div><hr><h1 id="Agent-Classes" data-id="Agent-Classes"><a class="anchor hidden-xs" href="#Agent-Classes" title="Agent-Classes"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Agent Classes</span></h1><p><span>There are two different agent classes that can be used: the </span><code>LunaticAgent</code><span>, which is fully customizable, and the simpler but less flexible </span><a href="#LunaticChallenger"><code>LunaticChallenger</code></a><span>.</span></p><h2 id="Creation" data-id="Creation"><a class="anchor hidden-xs" href="#Creation" title="Creation"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Creation</span></h2><h3 id="LunaticChallenger" data-id="LunaticChallenger"><a class="anchor hidden-xs" href="#LunaticChallenger" title="LunaticChallenger"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>LunaticChallenger</span></h3><p><span>The </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/agents.html#agents.leaderboard_agent.LunaticChallenger" target="_blank" rel="noopener"><code>LunaticChallenger</code></a><span> is wrapped around the </span><code>LunaticAgent</code><span>. It can be more easily combined with the </span><a href="https://scenario-runner.readthedocs.io/en/latest/" target="_blank" rel="noopener"><span>ScenarioRunner</span></a><span> and be used with the </span><a href="https://leaderboard.carla.org/get_started/" target="_blank" rel="noopener"><span>Leaderboard 2.0</span></a><span> for which this class is especially designed.</span></p><p><span>In the simplest way an agent can be used like in the snipplet below. However we recommend that you follow the documentation from </span><a href="https://leaderboard.carla.org/get_started/" target="_blank" rel="noopener"><span>Leaderboard 2.0</span></a><span> and afterwards you can test this agent with by executing the </span><code>run_leaderboard_agent.sh</code><span> file.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># examples/minimal_leaderboard.py</span>
<span class="hljs-keyword">from</span> agents.leaderboard_agent <span class="hljs-keyword">import</span> LunaticChallenger
<span class="hljs-keyword">from</span> classes.worldmodel <span class="hljs-keyword">import</span> GameFramework

<span class="hljs-comment"># Sets up Carla and Pygame, and Hydra in a minimal way</span>
game_framework = GameFramework.quickstart()
ego = GameFramework.request_new_actor(<span class="hljs-string">"car"</span>, rolename=<span class="hljs-string">"hero"</span>, random_location=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># Create a lunatic agent</span>
agent = LunaticChallenger(<span class="hljs-string">"localhost"</span>, carla_port=<span class="hljs-number">2000</span>)
agent.setup(game_framework.launch_config) <span class="hljs-comment"># Do not forget this step!</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">while</span> game_framework.continue_loop:
        <span class="hljs-keyword">with</span> game_framework(agent):
            agent() <span class="hljs-comment"># This class should be called instead.</span>
            agent.apply_control()
<span class="hljs-keyword">except</span>:
    game_framework.cleanup()
    <span class="hljs-keyword">raise</span>
</div></div></code></pre><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> </span><strong><span>Note:</span></strong><span> The </span><code>LunaticChallenger</code><span> is easier to setup, however its usage and customization are limited as it complies with the </span><code>AutonomousAgent</code><span> interface from </span><a href="https://leaderboard.carla.org/get_started/" target="_blank" rel="noopener"><code>leaderboard-2.0</code></a><span>. It does only support a limited amount of features mentioned in the </span><a href="#Command-Line"><span>Configuration</span></a><span> section; for example, changing settings over the command line is not supported as the configuration is loaded in </span><code>agent.setup</code><span> or via the ScenarioRunner rather than a </span><code>@hydra.main</code><span> wrapped entry point.</span></p>
</div><h3 id="LunaticAgent" data-id="LunaticAgent"><a class="anchor hidden-xs" href="#LunaticAgent" title="LunaticAgent"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>LunaticAgent</span></h3><p><span>The </span><code>LunaticAgent</code><span> can be initialized in multiple ways and supports all features from the Section </span><a href="#Configuration-and-Hydra-Framework"><span>Configuration and Hydra Framework</span></a><span> section:</span></p><p><span>As an alternative to the </span><a href="#Quickstart"><span>Quickstart</span></a><span> snipplet, the agent can be initialized quicker with the game framework:</span></p><pre><code class="python hljs">agent, world_model, global_planner, keyboard_controller 
   = game_framework.init_agent_and_interface
   (ego, agent_class=LunaticAgent, config=behavior)
</code></pre><hr><h2 id="Workflow" data-id="Workflow"><a class="anchor hidden-xs" href="#Workflow" title="Workflow"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Workflow</span></h2><p><span>The agent lifecycle involves several stages from initialization to continuous operation. For a detailed workflow diagram, refer to </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/blob/main/docs/images/AgentLifecycleDiagram.drawio.svg" target="_blank" rel="noopener"><span>Workflow</span></a><span>.</span></p><p><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/raw/main/docs/images/AgentLifecycleDiagram.drawio.svg" target="_blank" rel="noopener"><img src="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/raw/main/docs/images/AgentLifecycleDiagram.drawio.svg" alt="AgentLifecycleDiagram.drawio" class="offline-handled error-handled" loading="lazy"></a><br>
<span>(click image for fullscreen)</span></p><p><span>This diagram illustrates the lifecycle and interactions within the Lunatic AI Driver, providing its operational workflow in detail.</span></p><hr><h2 id="Phases" data-id="Phases"><a class="anchor hidden-xs" href="#Phases" title="Phases"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Phases</span></h2><p><span>The </span><code>Phase</code><span> enumeration defines different stages and states that the agent transitions through during its operational cycle, as seen in the </span><a href="#Workflow"><span>workflow diagram</span></a><span>. Each phase is represented as a flag, allowing for combinations and structured management of the agent's behavior and decision-making processes.</span></p><p><span>Phases are needed for </span><code>Rule</code><span> definitions. The current phase is selected internally by the agent by calling </span><code>agent.execute_phase</code><span> which also evaluates the registered condition(s) for this phase.</span></p><h3 id="Definition" data-id="Definition"><a class="anchor hidden-xs" href="#Definition" title="Definition"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Definition</span></h3><p><span>The </span><code>Phase</code><span> enum includes:</span></p><ul>
<li>
<p><strong><span>Basic Phases</span></strong><span>:</span></p>
<ul>
<li><code>NONE</code><span>: Represents no specific phase.</span></li>
<li><code>BEGIN</code><span> and </span><code>END</code><span>: Marks the beginning and end of phases respectively. </span><strong><span>Must always be used as a combining flag with:</span></strong></li>
<li><code>UPDATE_INFORMATION</code><span>, </span><code>PLAN_PATH</code><span>, </span><code>DETECT_TRAFFIC_LIGHTS</code><span>, </span><code>DETECT_PEDESTRIANS</code><span>, </span><code>DETECT_CARS</code><span>, </span><code>TAKE_NORMAL_STEP</code><span>, </span><code>RSS_EVALUATION</code><span>, </span><code>APPLY_MANUAL_CONTROLS</code><span>, and </span><code>EXECUTION</code><span>: These phases handle different aspects of information processing, planning, detection of objects, execution, and manual control application.</span></li>
</ul>
</li>
<li>
<p><strong><span>Special Situations</span></strong><span>:</span></p>
<ul>
<li><code>CAR_DETECTED</code><span>, </span><code>TURNING_AT_JUNCTION</code><span>, </span><code>HAZARD</code><span>, </span><code>EMERGENCY</code><span>, </span><code>COLLISION</code><span>: These phases represent critical scenarios or events that require immediate attention or specialized handling.</span></li>
</ul>
</li>
<li>
<p><strong><span>Phase Combinations</span></strong><span>:</span></p>
<ul>
<li><code>DETECT_NON_CARS</code><span>, </span><code>DETECTION_PHASE</code><span>, </span><code>NORMAL_LOOP</code><span>, </span><code>IN_LOOP</code><span>: These are combinations of phases that over higher-level semantics during the agents workflow. See the online documentation for the</span></li>
</ul>
</li>
</ul><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> </span><strong><span>Note:</span></strong><span> Some phases (</span><code>APPLY_MANUAL_CONTROLS</code><span>, </span><code>EXECUTION</code><span>, </span><code>TERMINATING</code><span>, and possibly </span><code>DONE</code><span>) are outside of the jurisdiction of the agent's </span><code>run_step</code><span> function and are not guaranteed.</span></p>
<ul>
<li><code>agent.parse_keyboard_input()</code><span> executes </span><code>APPLY_MANUAL_CONTROLS</code></li>
<li><code>agent.apply_control()</code><span> executes </span><code>EXECUTION</code></li>
</ul>
<p><code>agent.execute_phase(phase, prior_result=optional_phase_result, update_controls=optional_new_control)</code><span> must be called to change the agent's phase explicitly. See the </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/blob/main/AgentGameLoop.py" target="_blank" rel="noopener"><span>AgentGameLoop.py</span></a><span> for examples.</span></p>
</div><h3 id="Emergency-Phase" data-id="Emergency-Phase"><a class="anchor hidden-xs" href="#Emergency-Phase" title="Emergency-Phase"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Emergency Phase</span></h3><p><span>If the agent detects an emergency, i.e. an obstacle in its path. The agent will enter </span><code>Phase.EMERGENCY | Phase.BEGIN</code><span> a </span><code>Rule</code><span> needs to clear the </span><code>agent.detected_hazards</code><span> to prevent an </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/classes.html#classes.exceptions.EmergencyStopException" target="_blank" rel="noopener"><code>EmergencyStopException</code></a><span>.</span></p><p><span>If an </span><code>EmergencyStopException</code><span> is raised, which can also be done by a </span><a href="#Rule-and-Action-Functions"><span>rule's action</span></a><span>, the agent will calculate a response and afterwards enters </span><code>Phase.EMERGENCY | Phase.END</code><span> where it can be modified or replaced.</span></p><hr><h1 id="Rules" data-id="Rules"><a class="anchor hidden-xs" href="#Rules" title="Rules"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Rules</span></h1><p><span>Rule functions play crucial roles in defining behavioral logic and decision-making processes within the simulated environment. They serve as building blocks for conditions and actions based on the state of the simulation environment and the agent itself.</span></p><p><span>A rule's </span><code>condition</code><span> function typically adheres to a signature of </span><code>(ctx: Context) -&gt; Hashable</code><span> or </span><code>(self: Rule, ctx: Context) -&gt; Hashable</code><span>, where the latter allows for the inclusion the Rule instance as </span><code>self</code><span> argument in the condition.</span></p><p><span>See the section of the </span><a href="#Context-Object"><code>Context</code></a><span> class for more details about it.</span></p><h2 id="Evaluation-Function" data-id="Evaluation-Function"><a class="anchor hidden-xs" href="#Evaluation-Function" title="Evaluation-Function"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Evaluation Function</span></h2><p><span>The ConditionFunction extends the capability of a standard function by adding utility that enhances its functionality in decision-making processes and </span><strong><span>must always return a hashable value.</span></strong><span> It can be utilized in several ways within the LunaticAI framework:</span></p><ul>
<li><strong><span>As a Decorator:</span></strong><span> The </span><code>@ConditionFunction</code><span> decorator allows mark functions, indicating they are used to evaluate conditions or states within the simulation. Optionally, a description can be provided to annotate the function's purpose.</span></li>
</ul><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-meta">@ConditionFunction</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">...</span>) -&gt; Hashable:
    ...

<span class="hljs-comment">#Provide a name for the function</span>
<span class="hljs-meta">@ConditionFunction(<span class="hljs-params"><span class="hljs-string">"This function always returns True"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">always_execute</span>(<span class="hljs-params">ctx</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

<span class="hljs-comment"># Keyword only arguments</span>
<span class="hljs-meta">@ConditionFunction(<span class="hljs-params">truthy=<span class="hljs-literal">True</span>, use_self=<span class="hljs-literal">False</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_this</span>(<span class="hljs-params">ctx: Context, value=<span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
    <span class="hljs-comment"># In the background value will be converted to bool(value)</span>
    <span class="hljs-keyword">return</span> value 
</div></div></code></pre><ul>
<li><strong><span>Functional:</span></strong><span> The functional approach has the advantage that a function can be used in different ConditionFunctions. This is especially useful if actions are tied to conditions through </span><code>ConditionFunction.register_action</code></li>
</ul><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">def</span> <span class="hljs-title function_">free_condition</span>(<span class="hljs-params">self, ctx: Context</span>):
    <span class="hljs-string">"""A function not tied to one ConditionFunction"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">action1</span>(<span class="hljs-params">self</span>):
    ...
<span class="hljs-keyword">def</span> <span class="hljs-title function_">action2</span>(<span class="hljs-params">self, ctx: Context</span>)
    ...

do_action1 = ConditionFunction(free_condition)
do_action1.register_action(action1)

do_action2 = do_action1.copy()
do_action2.register_action(action2)
</div></div></code></pre><h3 id="Registering-Actions" data-id="Registering-Actions"><a class="anchor hidden-xs" href="#Registering-Actions" title="Registering-Actions"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Registering Actions</span></h3><p><span>There are three ways to determine which action should follow a rule.</span></p><ul>
<li>
<p><span>Defining actions in the </span><a href="#Rule-Classes-and-Features"><code>Rule</code></a><span> class</span></p>
<ol style="padding-left: 2em;">
<li><span>If the rule returns </span><code>True</code><span> the function registered as </span><code>action</code><span> will be executed. Otherwise if </span><code>False</code><span> the registered </span><code>false_action</code><span>.</span></li>
<li><span>An ConditionFunction can return any Hashable value. The possible return values and functions that should be executed are passed to the </span><a href="#Rule-Classes-and-Features"><code>Rule</code></a><span> class with a </span><code>actions : Dict[Hashable, Callable]</code><span> argument/attribute.</span></li>
</ol>
</li>
<li>
<p><span>Register a action with an ConditionFunction</span></p>
<pre><code class="python hljs">​​​​@ConditionFunction
​​​​<span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">...</span>) -&gt; Hashable:
​​​​    rand = random.choice([<span class="hljs-literal">True</span>, <span class="hljs-string">"one"</span>])
​​​​    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> rand == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> rand
​​​​
​​​​@foo.register_action
​​​​<span class="hljs-keyword">def</span> <span class="hljs-title function_">true</span>(<span class="hljs-params">ctx</span>):
​​​​    <span class="hljs-string">"""executed when foo returns True"""</span>
​​​​    
​​​​@foo.register_action(<span class="hljs-string">"one"</span>)
​​​​<span class="hljs-keyword">def</span> <span class="hljs-title function_">one</span>(<span class="hljs-params">ctx</span>):
​​​​    <span class="hljs-string">"""executed when foo returns 'one' """</span>
</code></pre>
<p><code>foo</code><span> can now be used with functional or class API of a rule, providing an action is not necessary.</span></p>
<div class="alert alert-warning">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> If an ConditionFunction has registered actions the Rule class may not be initialized with the </span><code>action(s)</code><span> argument/attribute.</span></p>
</div>
</li>
</ul><hr><h2 id="Rule-Classes-and-Features" data-id="Rule-Classes-and-Features"><a class="anchor hidden-xs" href="#Rule-Classes-and-Features" title="Rule-Classes-and-Features"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Rule Classes and Features</span></h2><p><span>Defining rules and actions is facilitated through multiple APIs. Each approach offers distinct advantages in organizing and implementing behavioral logic within the simulation environment.</span><br>
<span>The keyword and attributes are shared. For the full list refer to the </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/classes.html#classes.rule.Rule" target="_blank" rel="noopener"><span>online documentation</span></a><span>.</span></p><h3 id="Functional-API" data-id="Functional-API"><a class="anchor hidden-xs" href="#Functional-API" title="Functional-API"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Functional API</span></h3><p><span>The Functional API involves instantiating rule objects directly from the rule class. Here’s an example:</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code">slow_down_rule = Rule(Phase.TURNING_AT_JUNCTION | Phase.BEGIN,
                      condition=<span class="hljs-keyword">lambda</span> ctx: <span class="hljs-literal">True</span>,
                      action=...,
                      overwrite_settings={<span class="hljs-string">"speed"</span>: {<span class="hljs-string">"intersection_speed_decrease"</span>: <span class="hljs-number">10</span>}},
                      description=<span class="hljs-string">"Set speed to intersection speed"</span>)
</div></div></code></pre><h3 id="Class-API" data-id="Class-API"><a class="anchor hidden-xs" href="#Class-API" title="Class-API"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Class API</span></h3><p><span>The Class API allows defining rules and actions within the class body. Functions defined with </span><code>self</code><span> and </span><code>ctx</code><span> arguments can utilize instance attributes. The class still needs to be instantiated for use:</span></p><pre><code class="wrap python hljs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SlowDownAtIntersectionRule</span>(<span class="hljs-title class_ inherited__">Rule</span>):
    <span class="hljs-string">"""This is the rules description"""</span>
    
    phases = Phase.TURNING_AT_JUNCTION | Phase.BEGIN
    <span class="hljs-string">"""A single or a set of phases when the condition should be checked"""</span>
    
    <span class="hljs-comment"># Both condition and action can be defined as functions (only the Context argument is passed)</span>
    <span class="hljs-comment"># or as methods (self and Context argument)</span>
<span class="hljs-meta">    @ConditionFunction</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">condition</span>(<span class="hljs-params">ctx: Context</span>) -&gt; Hashable:
        ...
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">action</span>(<span class="hljs-params">self, ctx: Context</span>):
        ...
    overwrite_settings = {<span class="hljs-string">"speed"</span>: {<span class="hljs-string">"intersection_speed_decrease"</span>: <span class="hljs-number">10</span>}}
    <span class="hljs-string">"""Overwrite the agent's settings accessed via `ctx.config`."""</span>
    
    cooldown_reset_value : <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>
    <span class="hljs-string">"""Determines the amount of ticks the rule
    cannot trigger after the `action` was executed."""</span>
    
    group : <span class="hljs-built_in">str</span> = <span class="hljs-string">"JuntionSpeed"</span>
    
    priority = RulePriority.NORMAL
    <span class="hljs-string">"""An indicator how important this rule is. Used e.g. by `MultiRule`"""</span>

<span class="hljs-comment"># Create an instance of the rule</span>
slow_down_rule = SlowDownAtIntersectionRule()
</code></pre><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> Please refer to the online documentation of the </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/classes.html#classes.rule.Rule" target="_blank" rel="noopener"><code>Rule</code></a><span> class for further attributes that are available.</span></p>
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> The </span><strong><code>overwrite_settings</code><span> are only available over the read-only </span><code>ctx.config</code></strong><span> and </span><strong><span>must modify the </span><code>agent.config</code><span> if they should persists</span></strong><span>.</span></p>
</div><hr><div class="alert alert-warning">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> There is also a </span><strong><span>decorator API</span></strong><span> that allows to create rules a bit faster, but we do not encourage its usage.</span></p>
<pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-meta">@Rule </span><span class="hljs-comment"># This directly creates an instance and not a class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">slow_down_rule</span>:
    ...
</div></div></code></pre>
</div><h3 id="MultiRule-Class" data-id="MultiRule-Class"><a class="anchor hidden-xs" href="#MultiRule-Class" title="MultiRule-Class"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>MultiRule Class</span></h3><p><span>Extends the </span><code>Rule</code><span> class to support complex rules composed of multiple child rules. It includes mechanisms to evaluate rules by priority and wrap actions to evaluate child rules. </span><code>MultiRule</code><span>s are branching points in the rule system.</span></p><pre><code class="wrap python hljs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiRule</span>(metaclass=Rule):
    <span class="hljs-string">"""Complements the Rule class by"""</span>
    
    rules : <span class="hljs-type">List</span>[Rule]
    <span class="hljs-string">"""Child rules to execute"""</span>
    
    sort_rules = <span class="hljs-literal">True</span>
    <span class="hljs-string">"""If the `rules` should be sorted by priority"""</span>
    
    execute_all_rules = <span class="hljs-literal">False</span>
    <span class="hljs-string">"""
    If False will only execute the first rule with a applicable condition, i.e. this MultiRule is like a node in a decision tree.
    
    If True all rules are evaluated, unless one raises a `DoNotEvaluateChildRules` exception.
    """</span>
</code></pre><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> A </span><code>MultiRule</code><span> will still execute its own </span><code>action</code><span> before the child rules are evaluated.</span></p>
</div><h3 id="RandomRule-Class" data-id="RandomRule-Class"><a class="anchor hidden-xs" href="#RandomRule-Class" title="RandomRule-Class"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>RandomRule Class:</span></h3><p><span>Instead of evaluating all child rules one random rule is executed.</span></p><pre><code class="wrap python hljs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RandomRule</span>(metaclass=MultiRule):
    <span class="hljs-string">"""Complements the Multi Rule class by"""</span>
    
    weights : <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]] = <span class="hljs-literal">None</span>
    <span class="hljs-string">"""Weights for the rules attribute, if None the the rule.priority.value is chosen as weight."""</span>
    
    repeat_if_not_applicable = <span class="hljs-literal">True</span>
    <span class="hljs-string">"""If the randomly chosen rule's condition does not trigger an action another rule will be evaluated until one condition is met, or all rules have been tried.
    """</span>
</code></pre><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> If you provide one child rule and an additional "dummy", you can craft a rule that only triggers by chance.</span></p>
</div><h3 id="Cooldown-and-Group-Management" data-id="Cooldown-and-Group-Management"><a class="anchor hidden-xs" href="#Cooldown-and-Group-Management" title="Cooldown-and-Group-Management"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Cooldown and Group Management</span></h3><p><span>A Rule class can have a cooldown periods in ticks, ensuring rules are not executed too frequently. If a </span><code>group = "name"</code><span> is provided the cooldown value is shared with all other members. If one rule of a group is triggered all others of the same group cannot execute until this shared cooldown is zero again.</span></p><div class="alert alert-info">
<p><span>We recommend to write group names like </span><code>"topic.priority"</code><span> for a potential later feature that higher priority rules still can trigger more early.</span></p>
</div><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># Cooldowns can be set:</span>
rule.reset_cooldown()         <span class="hljs-comment"># back to default</span>
rule.cooldown = any_int_value <span class="hljs-comment"># any value; is a group aware setter</span>

<span class="hljs-comment"># Cooldowns can be ticked globally by calling</span>
Rule.CooldownFramework.tick()

<span class="hljs-comment"># or alternatively inside your game loop you have these options:</span>

<span class="hljs-comment"># Not not use the GameFramework: no rendering, limited exception handling.</span>
<span class="hljs-keyword">with</span> Rule.CooldownFramework(): <span class="hljs-comment"># with () brackets!</span>
    agent.run_step()
    
<span class="hljs-comment"># if the agent was created over the GameFramework this is more efficient</span>
<span class="hljs-keyword">with</span> game_framework:
    ...
    
<span class="hljs-keyword">with</span> game_framework(agent):
    ...
</div></div></code></pre><h3 id="Duplicating-a-Rule" data-id="Duplicating-a-Rule"><a class="anchor hidden-xs" href="#Duplicating-a-Rule" title="Duplicating-a-Rule"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Duplicating a Rule</span></h3><p><span>Rules can be duplicated by calling the </span><code>new_rule = old_rule.clone()</code><span> method on the rule object. Similarly, </span><code>new_rule = Rule(old_rule)</code><span>  is also valid, which allows to copy attributes to a different class should this be necessary.</span></p><h3 id="Rule-and-Action-Functions" data-id="Rule-and-Action-Functions"><a class="anchor hidden-xs" href="#Rule-and-Action-Functions" title="Rule-and-Action-Functions"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Rule and Action Functions</span></h3><p><span>Rules and actions will always receive the </span><code>ctx : Context</code><span> argument. Additionally they can be implemented the </span><code>self : Rule</code><span> object to access and modify attributes of rule instance.</span><br>
<span>If a function implements more than one argument in its signature it will receive the </span><code>self : Rule</code><span> argument as first parameter and the </span><code>ctx : Context</code><span> as second.</span></p><p><span>In case you want to use a rule function with more than one attribute, but not the </span><code>self</code><span> attribute you can wrap it with </span><code>@ConditionFunction(use_self=False)</code><span>, as seen </span><a href="#Evaluation-Function"><span>above</span></a><span>.</span></p><h4 id="Modifying-the-Workflow-through-Actions" data-id="Modifying-the-Workflow-through-Actions"><a class="anchor hidden-xs" href="#Modifying-the-Workflow-through-Actions" title="Modifying-the-Workflow-through-Actions"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Modifying the Workflow through Actions.</span></h4><p><span>By raising special exceptions can actions and conditions influence the </span><a href="#Workflow"><span>workflow</span></a><span> of the agent. A list of the exceptions and their documentation can be found in the </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/classes.html#module-classes.exceptions" target="_blank" rel="noopener"><span>classes.exceptions</span></a><span> submodule; see also the </span><a href="#Emergency-Phase"><span>Emergency Phase</span></a><span> section.</span></p><p><span>Foremost can </span><code>ContinueLoopException</code><span>, </span><code>SkipInnerLoopException(planned_control)</code><span> and </span><code>EmergencyStopException(hazards)</code><span> be raised to leave </span><code>agent.run_step</code><span> and </span><code>agent._inner_step</code><span>.</span></p><p><span>This is useful if a rule's action determined a final control the agent should execute. Only a </span><code>ContinueLoopException</code><span> also skips the </span><code>Phase.RSS_EVALUATION</code><span> phase.</span></p><hr><h2 id="Creating-New-Rule-Metaclass" data-id="Creating-New-Rule-Metaclass"><a class="anchor hidden-xs" href="#Creating-New-Rule-Metaclass" title="Creating-New-Rule-Metaclass"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Creating New Rule Metaclass</span></h2><p><span>If you want to create a new Rule class like </span><code>MultiRule</code><span>  that should serve as an archetype for rule instances use the </span><code>metaclass=Rule</code><span> keyword when you create this class:</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewRuleType</span>(metaclass=Rule):
    <span class="hljs-string">"""
    Define like a normal python class.
    Add the functions you need.
    """</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">phases, ...</span>):
        ...
        
        <span class="hljs-built_in">super</span>().__init__(phases, ...) <span class="hljs-comment"># will call Rule.__init__</span>
        
        
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VariantOfNewRule</span>(<span class="hljs-title class_ inherited__">NewRuleType</span>):
    <span class="hljs-string">"""Define after the Rule Class API"""</span>
    phase = ...
</div></div></code></pre><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> Normal subclassing, e.g. to copy attributes or helper functions is  possible. Using </span><code>metaclass</code><span> is especially helpful when you need a custom </span><code>__init__</code><span> method.</span></p>
</div><hr><h2 id="Adding-Rules-to-Agent" data-id="Adding-Rules-to-Agent"><a class="anchor hidden-xs" href="#Adding-Rules-to-Agent" title="Adding-Rules-to-Agent"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Adding Rules to Agent</span></h2><p><span>A single rule can be added by calling </span><code>agent.add_rule(rule)</code><span> or multiple rules by calling </span><code>agent.add_rules(rules)</code><span>.</span></p><p><span>For example:</span></p><pre><code class="python hljs">rules = [Rule1(), Rule2(), Rule3()]
agent.add_rules(rules)

<span class="hljs-comment"># Adding the default rules.</span>
agent.add_rules(agents.rules.create_default_rules())
</code></pre><hr><h1 id="Context-Object" data-id="Context-Object"><a class="anchor hidden-xs" href="#Context-Object" title="Context-Object"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Context Object</span></h1><p><span>A tick-constant </span><code>Context</code><span> object provides necessary simulation data to rules and actions. The </span><code>agent.ctx</code><span> object is passed as </span><code>ctx</code><span> argument to all rule functions and actions. It gives access to all information from the agent, config, current tick and the current rule or action that currently executed. Key attributes and methods include:</span></p><h2 id="Attributes" data-id="Attributes"><a class="anchor hidden-xs" href="#Attributes" title="Attributes"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Attributes:</span></h2><ul>
<li><code>agent:</code><span> Backreference to the agent.</span></li>
<li><code>current_phase:</code><span> Current phase of the agent.</span></li>
<li><code>config:</code><span> Read-only merge of the agents config and a rule's </span><code>overwrite_settings</code><span>.</span></li>
<li><code>live_info:</code><span> Quicker access to </span><code>agent.config.live_info</code></li>
<li><strong><code>control:</code><span> Holds the vehicle's </span><em><span>final</span></em><span> control command</span></strong><span> that should be executed in the end and </span><strong><span>can be replaced</span></strong><span> by any action.</span><br>
<span>Formally it is updated at the end of certain phases at the end or after the agent's inner step: </span><code>agent.execute_phase(phase, control=new_control)</code><span>. Check the </span><a href="#Workflow"><span>workflow diagram</span></a><span> for the phases where this update is done.</span></li>
</ul><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":exclamation:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/exclamation.png"><span> Key points:</span></p>
<ul>
<li><span>The </span><code>Context.config</code><span> object is a copy of the agent's config merged with the </span><code>overwrite_settings</code><span> of the associated </span><a href="#Class-API"><code>Rule</code></a><span>. During the </span><code>condition</code><span> evaluation these changes are temporary, if a rule's action is executed the </span><code>overwrite_settings</code><span> are merged into the </span><code>Context.config</code><span> for the rest of this tick. For permanent changes the agent's config needs to be adjusted seperately.</span></li>
<li><strong><span>The </span><code>Context.config</code><span> is the configuration used by the local planner to calculate the controls of this tick.</span></strong></li>
<li><span>The </span><code>ctx.control</code><span> object is used when </span><code>agent.apply_control()</code><span> is used.</span></li>
</ul>
</div><hr><h1 id="Configuration-and-Hydra-Framework" data-id="Configuration-and-Hydra-Framework"><a class="anchor hidden-xs" href="#Configuration-and-Hydra-Framework" title="Configuration-and-Hydra-Framework"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Configuration and Hydra Framework</span></h1><h2 id="Launching-Customized-Experiments" data-id="Launching-Customized-Experiments"><a class="anchor hidden-xs" href="#Launching-Customized-Experiments" title="Launching-Customized-Experiments"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Launching Customized Experiments</span></h2><p><span>Experiments with different configurations can launched over the command line like:</span></p><pre><code class="shell hljs">python AgentGameLoop.py \
        agent=leaderboard \
        experiments=[sync_on,fast_driver] \
        agent.ignore_traffic_lights=true
</code></pre><h3 id="Explaination" data-id="Explaination"><a class="anchor hidden-xs" href="#Explaination" title="Explaination"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Explaination</span></h3><p><span>In the script is a with </span><code>@hydra.main</code><span> decorated main function that loads configuration in the following way:</span></p><ul>
<li><code>agent=leaderboard</code><span> selects the main configuration from </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/blob/main/conf/agent/leaderboard.yaml" target="_blank" rel="noopener"><span>conf/agent/leaderboard.yaml</span></a><span>. Default: </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/blob/main/conf/agent/default_settings.yaml" target="_blank" rel="noopener"><span>conf/agent/default_settings.yaml</span></a><span>.</span></li>
<li><code>experiments=[sync_on,fast_driver]</code><span> merges the smaller configurations from </span><em><span>conf/experiments/sync_on.yaml</span></em><span> and </span><em><span>conf/experiments/fast_driver.yaml</span></em><span> on top.</span></li>
<li><code>agent.ignore_traffic_lights=true</code><span> overrides a single option.</span></li>
</ul><p><span>The order of the command line arguments do not matter.</span><br>
<span>The resolution order picked from the conf/ directory is:</span></p><ol style="padding-left: 2em;">
<li><span>launch_config.yaml</span></li>
<li><span>agent/</span></li>
<li><span>config_extensions/camera.yaml</span></li>
<li><span>config_extension/job_logging.yaml</span></li>
<li><span>experiments</span></li>
<li><span>single command line overrides</span></li>
</ol><div class="alert alert-danger">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> The </span><code>GameFramework.quickstart</code><span> method is currently not available when using </span><code>@hydra.main</code><span>.</span></p>
</div><hr><h2 id="Hydra-Framework" data-id="Hydra-Framework"><a class="anchor hidden-xs" href="#Hydra-Framework" title="Hydra-Framework"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Hydra Framework</span></h2><p><span>To configure the agent and nearly all other aspects of an experiment we use the </span><a href="https://hydra.cc/" target="_blank" rel="noopener"><span>Hydra</span></a><span> framework which in turn builds upon the flexible </span><code>DictConfig</code><span> from </span><a href="https://omegaconf.readthedocs.io/" target="_blank" rel="noopener"><span>OmegaConf</span></a><span>.</span></p><p><span>Additionally to building the configuration in a hierarchical way Hydra also tracks and logs the output of experiments, for example each output of a run is stored in the outputs folder configured by </span><code>hydra.run.dir</code><span> in the </span><a href="#LaunchConfig"><span>LaunchConfig</span></a><span>, likewise will recordings and a copy of the configuration of the experiment stored in this folder.</span></p><hr><h2 id="Config-Hierarchy" data-id="Config-Hierarchy"><a class="anchor hidden-xs" href="#Config-Hierarchy" title="Config-Hierarchy"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Config Hierarchy</span></h2><p><span>The configuration is build in a hierarchical way merging different configuration files. Foremost </span><a href="" target="_blank" rel="noopener"><span>conf/launch_config.yaml</span></a><span> and </span><a href="" target="_blank" rel="noopener"><span>conf/agent/default_settings.yaml</span></a><span>.</span></p><p><span>A documentation of the full settings are included in the </span><a href="#Example-of-full-Agent-Settings"><span>Appendix</span></a><span>.</span><br>
<span>For the agent you can also refer to </span><a href="" target="_blank" rel="noopener"><span>conf/agent_settings_full_example.md</span></a><span>.</span></p><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> </span><strong><span>Note:</span></strong><span> The automatic logging of outputs only partially applies for the </span><a href="#LunaticChallenger"><span>LunaticChallenger</span></a><span> class, as its entry point is the </span><a href="https://leaderboard.carla.org/" target="_blank" rel="noopener"><span>carla leaderboard</span></a><span> script.</span><br>
<span>While logging output and recordings are placed in the </span><code>hydra.run.dir</code><span> outputs created by the </span><em><span>leaderboard</span></em><span> are not placed there.</span></p>
<p><span>A solution is to make use of Hydra's feature to change the </span><a href="https://hydra.cc/docs/tutorials/basic/running_your_app/working_directory/#disable-changing-current-working-dir-to-jobs-output-dir" target="_blank" rel="noopener"><span>working directory</span></a><span> through the </span><code>hydra.job.chdir</code><span> option.</span><br>
<span>Or, by modifying the output path of the leaderboard to </span><code>hydra.runtime.output_dir</code><span>.</span></p>
</div><h3 id="LaunchConfig" data-id="LaunchConfig"><a class="anchor hidden-xs" href="#LaunchConfig" title="LaunchConfig"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>LaunchConfig</span></h3><p><span>The </span><a href="" target="_blank" rel="noopener"><span>conf/launch_config.yaml</span></a><span> is the top-level config file used to configure the Carla simulator, the user-interface and output folder (</span><code>hydra.run.dir</code><span>).</span></p><p><span>Complemented is it by subconfigurations imported trough </span><a href="https://hydra.cc/docs/advanced/defaults_list/" target="_blank" rel="noopener"><span>Hydra's defaults list</span></a><span>. These subconfigurations are placed in </span><a href="" target="_blank" rel="noopener"><span>conf/config_extensions/</span></a><span> and </span><a href="" target="_blank" rel="noopener"><span>conf/agents/</span></a><span>.</span></p><h3 id="AgentConfig" data-id="AgentConfig"><a class="anchor hidden-xs" href="#AgentConfig" title="AgentConfig"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>AgentConfig</span></h3><p><span>The agent configuration are stored in </span><a href="" target="_blank" rel="noopener"><span>conf/agents</span></a><span>. Each configuration there has to include all keys and must be a stand-alone configuration, however merging with existing configurations is possible, take the </span><a href="" target="_blank" rel="noopener"><span>conf/agents/leaderboard.yaml</span></a><span> as an example on how to do that.</span></p><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> While the AgentConfig is at the start a subconfig of the LaunchConfig, it will be separated as a standalone config during the agent's initalization.</span><br>
<span>That means that </span><a href="https://omegaconf.readthedocs.io/en/latest/usage.html#variable-interpolation" target="_blank" rel="noopener"><span>interpolations</span></a><span> inside the AgentConfig treat the AgentConfig as top-level configuration and have no access to the LaunchConfig.</span></p>
<p><span>The LaunchConfig can still be accesses through </span><code>agent._world_model._args</code><span> by the agent.</span></p>
</div><h3 id="Type-checking-and-Type-forcing" data-id="Type-checking-and-Type-forcing"><a class="anchor hidden-xs" href="#Type-checking-and-Type-forcing" title="Type-checking-and-Type-forcing"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Type-checking and Type-forcing</span></h3><p><span>To allow for type-hints in IDEs and secure correct usage the config files are backed by </span><a href="https://hydra.cc/docs/tutorials/structured_config/intro/" target="_blank" rel="noopener"><span>structured config</span></a><span> schemas written as dataclasses in python code that are used for </span><a href="https://duckduckgo.com/?t=ffab&amp;q=duck-typing&amp;ia=web" target="_blank" rel="noopener"><span>"duck-typing"</span></a><span>, i.e. same behavior even if the underlying class is different (</span><code>@dataclass</code><span> vs. </span><code>DictConfig</code><span>). The defintion of the schema classes is done in </span><a href="" target="_blank" rel="noopener"><span>agents/tools/config_creation.py</span></a><span>.</span></p><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> This strictness is not enforced. To force this behavior please refer to Hydra's </span><a href="https://hydra.cc/docs/tutorials/structured_config/config_store/" target="_blank" rel="noopener"><span>Config Store API</span></a><span> or use this snipplet which is a weaker and more flexible version. For a detailed description please check the documentation of </span><code>agents.tools.config_creation.AgentConfig.check_config</code></p>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> agents.tools.config_creation <span class="hljs-keyword">import</span> LaunchConfig
<span class="hljs-string">"Launch Config is a python class decorated with @dataclasses.dataclass"</span>

<span class="hljs-meta">@hydra.main(<span class="hljs-params">version_base=<span class="hljs-literal">None</span>, config_path=<span class="hljs-string">"./conf"</span>, config_name=<span class="hljs-string">"launch_config"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">config: LaunchConfig</span>):
    <span class="hljs-string">"""
    Note: `config: LaunchConfig` is duck-typing:
          `args` is a omegaconf.DictConfig that should have the same 
          structure as LaunchConfig, but in fact it is not derived 
          from that class.
    """</span>
    
    <span class="hljs-comment"># Convert the args argument to a DictConfig that has been</span>
    <span class="hljs-comment"># checked against the schema.</span>
    <span class="hljs-comment"># Note: Creates a copy.</span>
    config = LaunchConfig.check_config(config, config.get(<span class="hljs-string">"strict_config"</span>, <span class="hljs-number">3</span>), as_dict_config=<span class="hljs-literal">True</span>) 
</code></pre>
</div><hr><h1 id="Further-Modules" data-id="Further-Modules"><a class="anchor hidden-xs" href="#Further-Modules" title="Further-Modules"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Further Modules</span></h1><p><span>The </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/agents.html#agents.lunatic_agent.LunaticAgent" target="_blank" rel="noopener"><code>LunaticAgent</code></a><span> makes use of various internal and external modules to gather information and improve its behavior. In this section we list the most important ones.</span></p><h2 id="GameFramework" data-id="GameFramework"><a class="anchor hidden-xs" href="#GameFramework" title="GameFramework"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>GameFramework</span></h2><p><span>The </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/classes.html#classes.worldmodel.GameFramework" target="_blank" rel="noopener"><code>GameFramework</code></a><span> is an optional module that eases the setup of carla and required submodules. During runtime, when used as context manager, it takes care of pygame and HUD rendering, rule cooldown updates as well as exception handling. At the end of the experiment it takes care destroying spawned actors and further cleanup tasks.</span></p><p><span>It is a subclass of the </span><a href="#CarlaDataProvider"><span>CarlaDataProvider</span></a><span>.</span></p><hr><h2 id="WorldModel" data-id="WorldModel"><a class="anchor hidden-xs" href="#WorldModel" title="WorldModel"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>WorldModel</span></h2><p><span>The </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/classes.html#classes.worldmodel.GameFramework" target="_blank" rel="noopener"><code>WorldModel</code></a><span> takes over some background tasks of the </span><a href="#GameFramework"><code>GameFramework</code></a><span> and is based on the World objects provided by most official </span><a href="https://github.com/carla-simulator/carla/blob/dev/PythonAPI/examples/rss/manual_control_rss.py" target="_blank" rel="noopener"><span>Carla examples</span></a><span>. It is responsible to communicate with the server, tick management and assures the creation of the ego vehicle before the scenario start.</span></p><p><span>Further the </span><code>WorldModel</code><span> manages submodules for the human interface like the camera, HUD and keyboard controls.</span></p><p><span>It is a subclass of the </span><a href="#CarlaDataProvider"><span>CarlaDataProvider</span></a><span>.</span></p><hr><h2 id="Information-Gathering" data-id="Information-Gathering"><a class="anchor hidden-xs" href="#Information-Gathering" title="Information-Gathering"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Information Gathering</span></h2><h3 id="CarlaDataProvider" data-id="CarlaDataProvider"><a class="anchor hidden-xs" href="#CarlaDataProvider" title="CarlaDataProvider"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>CarlaDataProvider</span></h3><p><span>The </span><a href="https://github.com/carla-simulator/scenario_runner/blob/master/srunner/scenariomanager/carla_data_provider.py" target="_blank" rel="noopener"><code>CarlaDataProvider</code></a><span> is a helper tool of the scenario_runner submodule used, it is used to spawn actors and tracks their physical information (velocity, location).</span><br>
<span>Making use of the CarlaDataProvider saves calls to the simulator and avoids repetition of certain calls, e.g. filtering of all vehicles.</span><br>
<span>Further does it provide access to the client, map and world, and other helpful functions.</span><br>
<span>At the end of an experiment it can cleanup all tracked actors with </span><code>CarlaDataProvider.cleanup</code><span> alternatively you can also use </span><code>GameFramework.cleanup</code><span>.</span></p><h3 id="Information-Manager" data-id="Information-Manager"><a class="anchor hidden-xs" href="#Information-Manager" title="Information-Manager"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Information Manager</span></h3><p><span>The LunaticAgent gathers some information at the start of each tick in </span><code>_update_information</code><span>.</span><br>
<span>Tick-constant information are preproccessed by the </span><a href="https://lunaticai-driver-for-carla-simulator.readthedocs.io/latest/data_gathering.html#data_gathering.information_manager.InformationManager" target="_blank" rel="noopener"><code>InformationManager</code></a><span>. This information includes filtering of actors by their type (vehicles, walkers, static_obstacles) and providing information which ones are of interest for the agent.</span></p><p><span>Further it tracks certain high-level situations of the agent and how long the agent has been in it, e.g. it detects if the agent is stopped and informs how long the agent has been stopped.</span></p><p><span>The full list of provided information is provided in the subclass </span><code>InformationManager.Information</code></p><pre><code class="python hljs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Information</span>(<span class="hljs-title class_ inherited__">NamedTuple</span>):
    current_waypoint: carla.Waypoint
    current_speed: <span class="hljs-built_in">float</span>
    current_states : <span class="hljs-type">Dict</span>[classes.constants.AgentState, <span class="hljs-built_in">int</span>]
    <span class="hljs-string">"""
    Count in ticks, how long the agent fullfills their conditions.
    E.g. Agent is driving, stopped, blocked, at a traffic light, ...
    """</span>

    relevant_traffic_light: carla.TrafficLight
    <span class="hljs-string">"""Next triggering bounding box"""</span>
    relevant_traffic_light_distance: <span class="hljs-built_in">float</span>

    vehicles: <span class="hljs-type">List</span>[carla.Vehicle]
    walkers: <span class="hljs-type">List</span>[carla.Walker]
    static_obstacles: <span class="hljs-type">List</span>[carla.Actor]
    <span class="hljs-string">"""Filtered obstacles by InformationManager.OBSTACLE_FILTER"""</span>
    obstacles : <span class="hljs-type">List</span>[carla.Actor]
    <span class="hljs-string">"""Union of vehicles, walkers and static_obstacles"""</span>

    walkers_nearby: <span class="hljs-type">List</span>[carla.Walker]
    vehicles_nearby: <span class="hljs-type">List</span>[carla.Vehicle]
    static_obstacles_nearby: <span class="hljs-type">List</span>[carla.Actor]
    obstacles_nearby: <span class="hljs-type">List</span>[carla.Actor]

    distances: <span class="hljs-type">Dict</span>[carla.Actor, <span class="hljs-built_in">float</span>]
    <span class="hljs-string">"""Distances to all actors in `obstacles`"""</span>
</code></pre><div class="alert alert-warning">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> As this information is not updated until the end of the agents step it is </span><strong><span>only reliable when running the simulator in synchronous mode</span></strong><span>.</span><br>
<span>Use </span><code>sync=True</code><span>, or use </span><code>sync=None handle_ticks=False</code><span> in combination with a second script that takes care of the world ticks in a synchronized way, e.g. the Leaderboard.</span></p>
</div><hr><h3 id="Detection-Matrix" data-id="Detection-Matrix"><a class="anchor hidden-xs" href="#Detection-Matrix" title="Detection-Matrix"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Detection Matrix</span></h3><p><span>The </span><strong><span>Car Detection Matrix</span></strong><span> is developed on a fork of </span><a href="https://github.com/CarlaInes/carla" target="_blank" rel="noopener"><span>CARLA</span></a><span> and it enables the detection and tracking of vehicles in the surrounding of the ego vehicle in a discrete way. It is an ordered dictionary representing the lanes around the ego vehicle containing placeholders to indicate vehicle presence, where values of </span><code>0</code><span> denote no vehicle, </span><code>1</code><span> denotes the ego vehicle, </span><code>2</code><span> indicates other cars, and </span><code>3</code><span> signifies no road. The matrix adjusts based on scenarios, either following the ego vehicle. However there are limitations involving junctions, for example, it is possible that not all lanes or cars are displayed near a junction.</span></p><div style="text-align: center; font-size: 15pt;">
 <img src="https://imgur.com/fH0ihCz.png" alt="Image showing the Datamatrix" class="center offline-handled error-handled"> 
</div><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> The matrix in the image has been rotated by 90 degrees. The raw data is a row layout of the lanes.</span></p>
</div><p><span>The agent can access the matrix trough the </span><code>LunaticAgent.detection_matrix</code><span> property, which in turn access the </span><code>DetectionMatrix</code><span> instance responsible for the update of the data.</span></p><p><span>For more detailed information on the car detection matrix and its implementation, you can refer to the following resources:</span></p><ul>
<li><a href="https://github.com/CarlaInes/carla" target="_blank" rel="noopener"><span>CarlaInes GitHub Repository</span></a></li>
<li><a href="https://github.com/CarlaInes/carla/blob/master/PythonAPI/SensorDataCollection/readme.md#return-values" target="_blank" rel="noopener"><span>Car Detection Matrix Documentation</span></a></li>
</ul><p><span>These resources offer comprehensive insights into the DetectionMatrix's capabilities and provide detailed technical documentation for integrating and utilizing this feature within the CARLA simulator.</span></p><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":bulb:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/bulb.png"><span> The detection matrix can be expensive to calculate, see the configuration section in the </span><a href="#Example-of-full-Agent-Settings"><span>Appendix</span></a><span> for possible ways to configure it (asynchronous or skipped updates) as well as debug tools, e.g. adding it to the pygame user interface.</span></p>
</div><hr><h2 id="Responsibility-Sensitive-Safety-RSS" data-id="Responsibility-Sensitive-Safety-RSS"><a class="anchor hidden-xs" href="#Responsibility-Sensitive-Safety-RSS" title="Responsibility-Sensitive-Safety-RSS"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Responsibility Sensitive Safety (RSS)</span></h2><div class="alert alert-info">
<p><img class="emoji offline-handled error-handled" alt=":warning:" src="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/images/basic/warning.png"><span> The RSS System is currently only available on Linux and needs a custom build version of CARLA. Please refer to the documentations linked below.</span></p>
</div><p><strong><span>RSS</span></strong><span> is a formal model developed by Mobileye, an Intel company, to ensure the safety of autonomous driving systems which can be integrated into the CARLA simulator. RSS aims to provide a framework for detecting dangers on the road and determining the safest maneuvers for autonomous vehicles. It achieves this by using a set of mathematical rules that assess various driving scenarios, taking into account factors like distance to other vehicles, relative speed, and road conditions. When potential dangers are detected, RSS prescribes specific maneuvers that the autonomous vehicle should undertake to maintain safety, such as adjusting speed, changing lanes, or stopping. These maneuvers are designed to be transparent and understandable, aiding in regulatory approval and fostering public trust.</span></p><p><span>Despite its advantages, RSS has several drawbacks. Implementing RSS requires additional computational resources, which can impact the overall performance of the autonomous driving system. Moreover, while RSS provides an intelligent framework for safety analysis, it is not perfect and may not handle every possible situation flawlessly. Due to slow updates or other errors it might also fail to provide solutions.</span></p><p><span>For more detailed information on RSS and its implementation, you can refer to the following resources:</span></p><ul>
<li><a href="https://carla.readthedocs.io/en/latest/adv_rss/" target="_blank" rel="noopener"><span>CARLA RSS Documentation</span></a></li>
<li><a href="https://carla.readthedocs.io/en/latest/python_api/#carla.RssSensor" target="_blank" rel="noopener"><span>CARLA Python API: RssSensor</span></a></li>
<li><a href="https://intel.github.io/ad-rss-lib/" target="_blank" rel="noopener"><span>Official Intel RSS Documentation</span></a></li>
<li><a href="https://github.com/carla-simulator/carla/blob/master/PythonAPI/examples/rss/manual_control_rss.py" target="_blank" rel="noopener"><span>Example implementation from CARLA</span></a></li>
</ul><p><span>These resources provide comprehensive insights into how RSS is integrated into autonomous driving systems and offer detailed technical documentation for developers and researchers.</span></p><h3 id="Integration" data-id="Integration"><a class="anchor hidden-xs" href="#Integration" title="Integration"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Integration</span></h3><p><span>Our setup of the RSS system is similar to the </span><a href="https://github.com/carla-simulator/carla/blob/master/PythonAPI/examples/rss/manual_control_rss.py" target="_blank" rel="noopener"><span>example</span></a><span> from CARLA. The </span><a href="https://carla.readthedocs.io/en/latest/python_api/#carla.RssRestrictor" target="_blank" rel="noopener"><span>carla.RssRestrictor</span></a><span> requires a proposal of controls that should be executed, hence it is one of the last steps in the </span><code>LunaticAgent</code><span>'s </span><a href="#Workflow"><span>workflow</span></a><span>.</span></p><p><span>Whether or not the proposed solution of the RSS system should be accepted or modified is rule based. A </span><code>Rule(Phase.RSS_EVALUATION | Phase.END)</code><span> must decide on the final control of the agent. By default we use the rule below:</span></p><pre><code class="python hljs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigBasedRSSUpdates</span>(<span class="hljs-title class_ inherited__">Rule</span>):
    <span class="hljs-string">"""Always accept RSS updates if `ctx.config.rss.always_accept_update` is set."""</span>
    phases = Phase.RSS_EVALUATION | Phase.END
    condition = if_config(<span class="hljs-string">"rss.always_accept_update"</span>, <span class="hljs-literal">True</span>)
    action = accept_rss_updates
</code></pre><hr><h1 id="Future-Work" data-id="Future-Work"><a class="anchor hidden-xs" href="#Future-Work" title="Future-Work"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Future Work</span></h1><ul>
<li><span>Open Issues</span>
<ul>
<li><span>Spawned actors from a different process are not picked up; see issue </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/issues/24" target="_blank" rel="noopener"><span>#24</span></a><span>. Assure that the CarlaDataProvider is the same python object.</span></li>
<li><span>Command line override options for the </span><code>LeaderboardAgent</code><span> when used with the leaderboard.</span></li>
</ul>
</li>
<li><span>Extend the InformationManger</span>
<ul>
<li><span>Allow asynchronous updates by providing a </span><code>carla.World.on_tick</code><span> callback update.</span></li>
<li><span>relevant_traffic_light refers to the next bounding box; however agent could be currently after the bounding box of a currently red light. </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/issues/26" target="_blank" rel="noopener"><span>Issue #26</span></a><span>.</span></li>
<li><span>Add more high level states, for example by making use of the detection matrix.</span></li>
</ul>
</li>
<li><span>Rules</span>
<ul>
<li><span>Rule cooldown rely on ticks rather than on game-time. In sync mode the time is constant in relation to </span><code>carla.WorldSettings.fixed_delta_seconds</code><span> which we make use of. The </span><code>scenario_runner</code><span> provides a </span><code>GameTime</code><span> object that likely can be used for future changes.</span>
<ul>
<li><span>The cooldown sharing of groups can be improved, high priority rules should still be able to be executed in emergency situations.</span></li>
</ul>
</li>
<li><span>Extend traffic rules; especially on junctions.</span></li>
<li><span>Add a </span><code>Rule.reset</code><span> functionality to be used when the agent is used over multiple scenarios. Currently the agents </span><code>__init__</code><span> must be called again.</span></li>
<li><span>An intelligent selection of rules based on the situation.</span></li>
</ul>
</li>
<li><span>The RSS library offers an intelligent and information rich system. This information must be translated into higher-level semantics to allow a better understanding and improved capabilities to analyze traffic situations, craft rules and manipulate the RSS system's response in an individual way.</span></li>
<li><span>The agent relies strongly on the path provided to it at the beginning. Replanning the route while not turning back to wrong waypoints and finding back to the route intended is an open issue.</span></li>
</ul><hr><h1 id="Appendix" data-id="Appendix"><a class="anchor hidden-xs" href="#Appendix" title="Appendix"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Appendix</span></h1><h2 id="Hazard-Enumeration" data-id="Hazard-Enumeration"><a class="anchor hidden-xs" href="#Hazard-Enumeration" title="Hazard-Enumeration"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Hazard Enumeration</span></h2><p><span>The </span><code>Hazard</code><span> enumeration categorizes different types and severity levels of hazards that an agent might encounter during its operation. This allows the agent to prioritize responses based on the severity and type of encountered hazards.</span></p><h3 id="Types-and-Severity-Levels" data-id="Types-and-Severity-Levels"><a class="anchor hidden-xs" href="#Types-and-Severity-Levels" title="Types-and-Severity-Levels"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Types and Severity Levels</span></h3><ul>
<li>
<p><strong><span>Types</span></strong><span>:</span></p>
<ul>
<li><code>TRAFFIC_LIGHT</code><span>, </span><code>PEDESTRIAN</code><span>, </span><code>CAR</code><span>, </span><code>OTHER</code><span>, </span><code>JUNCTION</code><span>: Represents various types of hazards such as traffic lights, pedestrians, cars, and junctions.</span></li>
<li><code>OBSTACLE</code><span>: Includes </span><code>PEDESTRIAN</code><span> and </span><code>CAR</code><span>.</span></li>
</ul>
</li>
<li>
<p><strong><span>Severity Levels</span></strong><span>:</span></p>
<ul>
<li><code>WARNING</code><span>, </span><code>CRITICAL</code><span>, </span><code>EMERGENCY</code><span>, </span><code>COLLISION</code><span>: Different levels of severity ranging from warning to emergency situations, including collisions. Whereas </span><code>EMERGENCY</code><span> and </span><code>CRITICAL</code><span> include the  levels before, i.e. </span><code>EMERGENCY</code><span> includes </span><code>CRITICAL</code><span> and </span><code>WARNING</code><span>.</span></li>
</ul>
</li>
</ul><p><span>For further exploration and detailed code review, refer to </span><a href="https://github.com/Daraan/LunaticAI-Driver-for-CARLA-Simulator/blob/main/classes/constants.py" target="_blank" rel="noopener"><span>Phases and Hazard Enumeration code</span></a><span> on GitHub.</span></p><hr><h2 id="Keyboard-Controls" data-id="Keyboard-Controls"><a class="anchor hidden-xs" href="#Keyboard-Controls" title="Keyboard-Controls"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Keyboard Controls</span></h2><p><span>Depending on the setup certain keys, e.g. </span><em><span>WASD</span></em><span> or user input, will not work, also user input can be disabled when calling </span><code>agent.parse_keyboard_input(False)</code><span>.</span></p><pre><code>Use ARROWS or WASD keys for control.

        W            : throttle
        S            : brake
        AD           : steer
        Q            : toggle reverse
        Space        : hand-brake
        P            : toggle autopilot (depends on setup)

        TAB          : change view
        Backspace    : change vehicle

        R            : toggle recording images to disk

        F2           : toggle RSS visualization mode
        F3           : increase log level
        F4           : decrease log level
        F5           : increase map log level
        F6           : decrease map log level
        B            : toggle RSS Road Boundaries Mode
        G            : RSS check drop current route (experimental)
        T            : toggle RSS (NotImplemented)
        N            : pause simulation (only slow down)

        F1           : toggle HUD
        H/?          : toggle help
        ESC          : quit
</code></pre><h2 id="Troubleshooting" data-id="Troubleshooting"><a class="anchor hidden-xs" href="#Troubleshooting" title="Troubleshooting"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Troubleshooting</span></h2><h3 id="RSS-is-not-available-possible-solutions" data-id="RSS-is-not-available-possible-solutions"><a class="anchor hidden-xs" href="#RSS-is-not-available-possible-solutions" title="RSS-is-not-available-possible-solutions"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>RSS is not available; possible solutions</span></h3><p><span>See the official </span><a href="https://carla.readthedocs.io/en/latest/adv_rss/" target="_blank" rel="noopener"><span>documentation</span></a><span> for the current version. Currently the RSS system is only available on Linux and needs a custom build CARLA simulator and PythonAPI version.</span></p><p><span>Check out branches on our </span><a href="https://github.com/Daraan/CARLA-Simulator-Fork-DebianFix" target="_blank" rel="noopener"><span>CARLA fork</span></a><span> for tested dev versions.</span></p><h3 id="BoostPythonArgumentError" data-id="BoostPythonArgumentError"><a class="anchor hidden-xs" href="#BoostPythonArgumentError" title="BoostPythonArgumentError"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Boost.Python.ArgumentError</span></h3><p><span>This error is in general caused by a wrong type in a CARLA API function.</span></p><p><span>A possible example:</span></p><pre><code class="wrap python hljs">Boost.Python.ArgumentError: Python argument types <span class="hljs-keyword">in</span>
    Map.get_waypoint(Map, NoneType)
did <span class="hljs-keyword">not</span> match C++ signature:
    get_waypoint(carla::client::Map {lvalue}, 
                 carla::geom::Location location, 
                 <span class="hljs-built_in">bool</span> project_to_road=<span class="hljs-literal">True</span>, 
                 <span class="hljs-built_in">int</span> lane_type=carla.libcarla.LaneType.Driving)
    
    
<span class="hljs-comment"># for example in the InformationManager.tick()</span>
current_waypoint : carla.Waypoint = &gt; CarlaDataProvider.get_map().get_waypoint(self.live_info.current_location)
</code></pre><h4 id="Solution" data-id="Solution"><a class="anchor hidden-xs" href="#Solution" title="Solution"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Solution</span></h4><p><span>When this happens in the information manager it is likely due to to the ego vehicle not registered in the CarlaDataProvider as </span><strong><span>a former run was not cleaned properly</span></strong><span>.</span></p><p><span>If this was not the case feel free to report this issue to us on Github.</span></p><h4 id="Rule-IndexError-tuple-index-out-of-range" data-id="Rule-IndexError-tuple-index-out-of-range"><a class="anchor hidden-xs" href="#Rule-IndexError-tuple-index-out-of-range" title="Rule-IndexError-tuple-index-out-of-range"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Rule: </span><code>IndexError: tuple index out of range</code></h4><p><span>This error will be less ambiguous in future python versions and turns into a </span><code>TypeError</code><span>.</span><br>
<span>A wrapped function requires at least one positional argument, but none was provided, for example only trough keyword arguments.</span></p><pre><code class="py hljs">  File <span class="hljs-string">".../lib/python3.10/functools.py"</span>, line <span class="hljs-number">925</span>, <span class="hljs-keyword">in</span> _method
    method = self.dispatcher.dispatch(args[<span class="hljs-number">0</span>].__class__)
IndexError: <span class="hljs-built_in">tuple</span> index out of <span class="hljs-built_in">range</span>
</code></pre><p><span>Likely the problem is that the condition was instantiated without a positional </span><code>phase(s)</code><span>.</span></p><h5 id="Solution1" data-id="Solution"><a class="anchor hidden-xs" href="#Solution1" title="Solution1"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Solution</span></h5><p><span>Use </span><code>Rule(Phase.NONE)</code><span> instead of </span><code>Rule(phases=Phase.NONE)</code><span>.</span></p><h4 id="Rule-TypeErrorffuncname-requires-at-least-1-positional-argument" data-id="Rule-TypeErrorffuncname-requires-at-least-1-positional-argument"><a class="anchor hidden-xs" href="#Rule-TypeErrorffuncname-requires-at-least-1-positional-argument" title="Rule-TypeErrorffuncname-requires-at-least-1-positional-argument"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Rule </span><code>TypeError(f'{funcname} requires at least 1 positional argument')</code></h4><p><span>see </span><a href="#Rule-IndexError-tuple-index-out-of-range"><span>IndexError</span></a><span> above.</span></p><hr><h3 id="GLIBCXX_3430-not-found" data-id="GLIBCXX_3430-not-found"><a class="anchor hidden-xs" href="#GLIBCXX_3430-not-found" title="GLIBCXX_3430-not-found"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>`GLIBCXX_3.4.30' not found</span></h3><pre><code>ImportError: .../lib/libstdc++.so.6: version `GLIBCXX_3.4.30' not found
(required by /home/.cache/Python-Eggs/carla-0.9.15-py3.10-linux-x86_64.egg-tmp/carla/libcarla.cpython-310-x86_64-linux-gnu.so)
</code></pre><h4 id="Solution2" data-id="Solution"><a class="anchor hidden-xs" href="#Solution2" title="Solution2"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Solution:</span></h4><p><span>Look at the script that is trowing the error, assure that </span><code>carla</code><span> is imported </span><em><span>before</span></em><span> </span><code>pygame</code><span>.</span></p><p><span>If the error still persists check your CARLA installation and required packages.</span></p><h2 id="Config-Settings" data-id="Config-Settings"><a class="anchor hidden-xs" href="#Config-Settings" title="Config-Settings"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Config Settings:</span></h2><h3 id="Example-of-the-LaunchConfig" data-id="Example-of-the-LaunchConfig"><a class="anchor hidden-xs" href="#Example-of-the-LaunchConfig" title="Example-of-the-LaunchConfig"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Example of the LaunchConfig</span></h3><pre><code class="yaml hljs"><span class="token comment"># LaunchConfig</span>

<span class="token comment"># If enabled will assert that the loaded config is a subset of the `LaunchConfig` class.</span>
<span class="token comment">#  </span>
<span class="token comment"># If set to &gt;= 2, will assert that during runtime the types are correct.</span>
<span class="token key atrule">strict_config</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">verbose</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># If True will create an interactive session with command line input</span>
<span class="token comment"># - NOTE: Needs custom code in the main file (Not implemented)</span>
<span class="token key atrule">interactive</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">seed</span><span class="token punctuation">:</span>
<span class="token key atrule">map</span><span class="token punctuation">:</span> Town04_Opt
<span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2000</span>
<span class="token key atrule">fps</span><span class="token punctuation">:</span> <span class="token number">20</span>

<span class="token comment"># If True, the simulation will be set to run in synchronous mode.</span>
<span class="token comment"># For False, the simulation will be set to run in asynchronous mode.</span>
<span class="token comment"># If None the world settings for synchronous mode will not be adjusted, </span>
<span class="token comment"># assuming this is handled by the user / external system.</span>
<span class="token key atrule">sync</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># Decide if the GameFramework &amp; WoldModel are allowed to call carla.World.tick()</span>
<span class="token comment"># or if `False` the ticks should be handled by an outside system.</span>
<span class="token key atrule">handle_ticks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token comment"># If True the agent will look for a new waypoint after the initial route is done.</span>
<span class="token comment"># - NOTE: Needs custom implementation in the main file.</span>
<span class="token key atrule">loop</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">width</span><span class="token punctuation">:</span> <span class="token number">1280</span>
<span class="token key atrule">height</span><span class="token punctuation">:</span> <span class="token number">720</span>

<span class="token comment"># Gamma correction of the camera.</span>
<span class="token comment"># Depending on the weather and map this might need to be adjusted.</span>
<span class="token key atrule">gamma</span><span class="token punctuation">:</span> <span class="token number">2.2</span>

<span class="token comment"># If False will spawn a vehicle for the agent to control, using the `filter` and `generation` settings.</span>
<span class="token comment"># Otherwise will not spawn a vehicle but will wait until an actor with the name defined in `rolename` (default: "hero") is found.</span>
<span class="token comment">#  </span>
<span class="token comment"># This vehicle needs to be spawned by another process, e.g. through the scenario runner.</span>
<span class="token key atrule">externalActor</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment"># Actor name to wait for if `externalActor` is True.</span>
<span class="token key atrule">rolename</span><span class="token punctuation">:</span> hero
<span class="token key atrule">filter</span><span class="token punctuation">:</span> vehicle.*
<span class="token key atrule">generation</span><span class="token punctuation">:</span> <span class="token number">2</span>

<span class="token comment"># Whether or not to use the Carla's TraficManager to autpilot  the agent</span>
<span class="token comment"># - NOTE: This disables the usage of the LunaticAgent</span>
<span class="token key atrule">autopilot</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token comment"># The Settings of the agent, will be inserted later</span>
<span class="token key atrule">agent</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
<span class="token comment"># The camera / pygame interface settings</span>
<span class="token key atrule">camera</span><span class="token punctuation">:</span>
  <span class="token key atrule">recorder</span><span class="token punctuation">:</span>
    <span class="token comment"># Folder to record the camera</span>
    <span class="token comment">#    </span>
    <span class="token comment">#    Needs two numeric conversion placeholders.</span>
    <span class="token comment">#    </span>
    <span class="token comment">#    Note:</span>
    <span class="token comment">#        When using the ${hydra:runtime.output_dir} resolver</span>
    <span class="token comment">#        @hydra.main needs to be used or hydra must be initialized.</span>
    <span class="token key atrule">output_path</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>hydra<span class="token punctuation">:</span>runtime.output_dir<span class="token punctuation">}</span>/recorder/session%03d/%08d.bmp
    
    <span class="token comment"># Frame interval for screenshots to take</span>
    <span class="token key atrule">frame_interval</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">detection_matrix</span><span class="token punctuation">:</span>
    <span class="token comment"># DetectionMatrix settings for the HUD</span>
  
    <span class="token comment"># Whether to draw the detection matrix</span>
    <span class="token key atrule">draw</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    
    <span class="token comment"># Whether to draw the numerical values as text</span>
    <span class="token key atrule">values</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    
    <span class="token comment"># Orient vertical (lanes are left to right) instead of horizontal.</span>
    <span class="token key atrule">vertical</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    
    <span class="token comment"># Settings for the pyplot.imshow function</span>
    <span class="token key atrule">imshow_settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">cmap</span><span class="token punctuation">:</span> jet
      
    <span class="token comment"># Settings for pyplot.text for the values</span>
    <span class="token key atrule">text_settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">color</span><span class="token punctuation">:</span> orange
</code></pre><h3 id="Example-of-full-Agent-Settings" data-id="Example-of-full-Agent-Settings"><a class="anchor hidden-xs" href="#Example-of-full-Agent-Settings" title="Example-of-full-Agent-Settings"><span class="octicon octicon-link ph ph-link-simple-horizontal"></span></a><span>Example of full Agent Settings</span></h3><p><span>You can find the typed version of this schema in </span><code>agents/tools/config_creation.py</code><span>.</span></p><pre><code class="yaml hljs"><span class="token comment"># LunaticAgentSettings</span>
<span class="token key atrule">overwrites</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token comment"># Keeps track of information that changes during the simulation.</span>
<span class="token key atrule">live_info</span><span class="token punctuation">:</span>
  <span class="token comment"># 3D Vector of the current velocity of the vehicle.</span>
  <span class="token key atrule">velocity_vector</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>

  <span class="token comment"># Velocity of the vehicle in km/h.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Note:</span>
  <span class="token comment">#     The `z` component is ignored.</span>
  <span class="token key atrule">current_speed</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token key atrule">current_transform</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token key atrule">current_location</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token key atrule">current_speed_limit</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>

  <span class="token comment"># Direction that was executed in the last step by the local planner</span>
  <span class="token comment">#  </span>
  <span class="token comment"># planner.target_road_option is the option last executed by the planner (constant)</span>
  <span class="token comment"># incoming direction is the next *planned* direction subject to change (variable)</span>
  <span class="token key atrule">executed_direction</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># RoadOption that will used for the current step</span>
  <span class="token key atrule">incoming_direction</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># Waypoint that is planned to be targeted in this step.</span>
  <span class="token key atrule">incoming_waypoint</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># incoming_direction in (RoadOption.LEFT, RoadOption.RIGHT)</span>
  <span class="token key atrule">is_taking_turn</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># incoming_direction in (RoadOption.CHANGELANELEFT, RoadOption.CHANGELANERIGHT)</span>
  <span class="token key atrule">is_changing_lane</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>

  <span class="token comment"># Traffic light that is closest to the next intersection.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Is `None` if the agent is at an intersection.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># + NOTE: This might not be in the path or infront of the vehicle.</span>
  <span class="token key atrule">next_traffic_light</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># Distance to the assumed next traffic light.</span>
  <span class="token key atrule">next_traffic_light_distance</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># VehicleControls </span>
  <span class="token key atrule">last_applied_controls</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>


<span class="token comment"># The three situations they adjust their speed; # SEE: `behavior_agent.car_following_manager`</span>
<span class="token comment">#  </span>
<span class="token comment"># Case A car in front and getting closer : slow down; slower than car in front</span>
<span class="token comment">#       Take minium from, speed decrease, speed limit adjustment and target_speed</span>
<span class="token comment">#       `target_speed` = min( other_vehicle_speed - self._behavior.speed_decrease, # &lt;-- slow down BELOW the other car</span>
<span class="token comment">#                           self._behavior.max_speed # use target_speed instead</span>
<span class="token comment">#                           self._speed_limit - self._behavior.speed_lim_dist])</span>
<span class="token comment"># Case B car in front but safe distance : match speed</span>
<span class="token comment">#       `target_speed` = min([</span>
<span class="token comment">#                 max(self._min_speed, other_vehicle_speed),  # &lt;- match speed</span>
<span class="token comment">#                 self._behavior.max_speed,</span>
<span class="token comment">#                 self._speed_limit - self._behavior.speed_lim_dist])</span>
<span class="token comment"># Case C front is clear</span>
<span class="token comment">#       `target_speed` = min([</span>
<span class="token comment">#                 self._behavior.max_speed,</span>
<span class="token comment">#                 self._speed_limit - self._behavior.speed_lim_dist])</span>
<span class="token key atrule">speed</span><span class="token punctuation">:</span>
  <span class="token comment"># This is a reference to live_info.current_speed, which is updated by the agent</span>
  <span class="token key atrule">current_speed</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>live_info.current_speed<span class="token punctuation">}</span>
  <span class="token comment"># This is a reference to live_info.current_speed_limit, which is updated by the agent</span>
  <span class="token key atrule">current_speed_limit</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>live_info.current_speed_limit<span class="token punctuation">}</span>
  <span class="token comment"># desired cruise speed in Km/h; overwritten by SpeedLimit if follow_speed_limit is True</span>
  <span class="token key atrule">target_speed</span><span class="token punctuation">:</span> <span class="token number">20.0</span>
  <span class="token comment"># If the agent should follow the speed limit. *NOTE:* SpeedLimit overwrites target_speed if True (local_planner.py)</span>
  <span class="token key atrule">follow_speed_limits</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

  <span class="token comment"># The maximum speed in km/h your vehicle will be able to reach.</span>
  <span class="token comment"># From normal behavior. This supersedes the target_speed when following the BehaviorAgent logic.</span>
  <span class="token key atrule">max_speed</span><span class="token punctuation">:</span> <span class="token number">50.0</span>
  <span class="token comment"># other_vehicle_speed</span>
  <span class="token key atrule">speed_decrease</span><span class="token punctuation">:</span> <span class="token number">10.0</span>
  <span class="token comment"># Time in s before a collision at the same speed -&gt; apply speed_decrease</span>
  <span class="token key atrule">safety_time</span><span class="token punctuation">:</span> <span class="token number">3.0</span>
  <span class="token comment"># Implement als variable, currently hard_coded</span>
  <span class="token key atrule">min_speed</span><span class="token punctuation">:</span> <span class="token number">5.0</span>

  <span class="token comment"># Difference to speed limit.</span>
  <span class="token comment"># NOTE: For negative values the car drives above speed limit</span>
  <span class="token key atrule">speed_lim_dist</span><span class="token punctuation">:</span> <span class="token number">3.0</span>
  <span class="token comment"># Reduction of the targeted_speed when approaching an intersection</span>
  <span class="token key atrule">intersection_speed_decrease</span><span class="token punctuation">:</span> <span class="token number">5.0</span>

  <span class="token comment"># TODO: Port from traffic manager.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Sets the difference the vehicle's intended speed and its current speed limit. </span>
  <span class="token comment"># Speed limits can be exceeded by setting the perc to a negative value. </span>
  <span class="token comment"># Default is 30. </span>
  <span class="token comment"># Exceeding a speed limit can be done using negative percentages.</span>
  <span class="token key atrule">vehicle_percentage_speed_difference</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># Formula or value to calculate the target speed when approaching an intersection</span>
  <span class="token key atrule">intersection_target_speed</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>min<span class="token punctuation">:</span>$<span class="token punctuation">{</span>.max_speed<span class="token punctuation">}</span><span class="token punctuation">,</span> $<span class="token punctuation">{</span>subtract<span class="token punctuation">:</span>$<span class="token punctuation">{</span>.current_speed_limit<span class="token punctuation">}</span><span class="token punctuation">,</span>
    $<span class="token punctuation">{</span>.intersection_speed_decrease<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>


<span class="token comment"># Collision Avoidance</span>
<span class="token comment"># -------------------</span>
<span class="token comment">#  </span>
<span class="token comment"># Distance in which for vehicles are checked.</span>
<span class="token comment">#  </span>
<span class="token comment"># Usage: max_distance = max(min_proximity_threshold, self._speed_limit / (2 if &lt;LANE CHANGE&gt; else 3 ) )</span>
<span class="token key atrule">distance</span><span class="token punctuation">:</span>
  <span class="token comment"># Emergency Stop Distance Trigger</span>
  <span class="token key atrule">emergency_braking_distance</span><span class="token punctuation">:</span> <span class="token number">5.0</span>

  <span class="token comment"># PORT from TrafficManager # TODO:</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Sets the minimum distance in meters that a vehicle has to keep with the others. </span>
  <span class="token comment"># The distance is in meters and will affect the minimum moving distance. It is computed from front to back of the vehicle objects.</span>
  <span class="token key atrule">distance_to_leading_vehicle</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>


<span class="token comment"># Lane Change -----</span>
<span class="token comment">#  </span>
<span class="token comment"># Adjust probability that in each timestep the actor will perform a left/right lane change, </span>
<span class="token comment"># dependent on lane change availability. </span>
<span class="token key atrule">lane_change</span><span class="token punctuation">:</span>
  <span class="token key atrule">same_lane_time</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token key atrule">other_lane_time</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token key atrule">lane_change_time</span><span class="token punctuation">:</span> <span class="token number">2.0</span>
  <span class="token comment"># Turns on or off lane changing behavior for a vehicle.</span>
  <span class="token key atrule">auto_lane_change</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token comment"># Adjust probability that in each timestep the actor will perform a left/right lane change, </span>
  <span class="token comment"># dependent on lane change availability.</span>
  <span class="token key atrule">random_left_lanechange_percentage</span><span class="token punctuation">:</span> <span class="token number">0.1</span>

  <span class="token comment"># Adjust probability that in each timestep the actor will perform a left/right lane change, </span>
  <span class="token comment"># dependent on lane change availability.</span>
  <span class="token key atrule">random_right_lanechange_percentage</span><span class="token punctuation">:</span> <span class="token number">0.1</span>

  <span class="token comment"># During the localization stage, this method sets a percent chance that vehicle will follow the keep right rule, </span>
  <span class="token comment"># and stay in the right lane.</span>
  <span class="token key atrule">keep_right_rule_percentage</span><span class="token punctuation">:</span> <span class="token number">0.7</span>
  <span class="token comment"># Cooldown value for a lane change in the 'lane_change' group.</span>
  <span class="token key atrule">random_lane_change_interval</span><span class="token punctuation">:</span> <span class="token number">200</span>


<span class="token comment"># --------------------------</span>
<span class="token comment"># Agent Level</span>
<span class="token comment"># see _affected_by_traffic_light and _affected_by_vehicle in basic_agent.py</span>
<span class="token comment"># --------------------------</span>
<span class="token comment"># Agents is aware of the vehicles and traffic lights within its distance parameters</span>
<span class="token comment"># optionally can always ignore them.</span>
<span class="token key atrule">obstacles</span><span class="token punctuation">:</span>
  <span class="token comment"># Whether the agent should ignore vehicles</span>
  <span class="token key atrule">ignore_vehicles</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># Whether the agent should ignore traffic lights</span>
  <span class="token key atrule">ignore_traffic_lights</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

  <span class="token comment"># Whether the agent should ignore stop signs</span>
  <span class="token comment">#  </span>
  <span class="token comment"># NOTE: No usage implemented!</span>
  <span class="token key atrule">ignore_stop_signs</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

  <span class="token comment"># True: Whether to use a general approach to detect vehicles invading other lanes due to the offset.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># False: Simplified approach, using only the plan waypoints (similar to TM)</span>
  <span class="token comment">#  </span>
  <span class="token comment"># See `BasicAgent._vehicle_obstacle_detected`</span>
  <span class="token key atrule">use_bbs_detection</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token comment"># Base distance to traffic lights to check if they affect the vehicle</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Usage:</span>
  <span class="token comment">#     max_tlight_distance  = base_tlight_threshold  + detection_speed_ratio * vehicle_speed</span>
  <span class="token key atrule">base_tlight_threshold</span><span class="token punctuation">:</span> <span class="token number">5.0</span>

  <span class="token comment"># Base distance to vehicles to check if they affect the vehicle</span>
  <span class="token comment">#         </span>
  <span class="token comment"># Usage:</span>
  <span class="token comment">#     Only vehicles with distance &lt; `nearby_vehicles_max_distance` are checked for </span>
  <span class="token comment">#     max_vehicle_distance = base_vehicle_threshold + detection_speed_ratio * vehicle_speed</span>
  <span class="token comment">#     </span>
  <span class="token comment">#     A vehicle is considered if distance &lt; max_vehicle_distance &lt; nearby_vehicles_max_distance</span>
  <span class="token key atrule">base_vehicle_threshold</span><span class="token punctuation">:</span> <span class="token number">5.0</span>

  <span class="token comment"># Increases detection range based on speed</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Usage: max_vehicle_distance = base_vehicle_threshold + detection_speed_ratio * vehicle_speed</span>
  <span class="token comment"># Usage: max_tlight_distance  = base_tlight_threshold  + detection_speed_ratio * vehicle_speed</span>
  <span class="token key atrule">detection_speed_ratio</span><span class="token punctuation">:</span> <span class="token number">1.0</span>

  <span class="token comment"># Whether to add a dynamic threshold based on the vehicle speed to the base threshold.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Usage: base_threshold + detection_speed_ratio * vehicle_speed</span>
  <span class="token comment">#  </span>
  <span class="token comment"># #NOTE: Currently only applied to traffic lights</span>
  <span class="token key atrule">dynamic_threshold</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Defines detection angles used when checking for obstacles.</span>
  <span class="token key atrule">detection_angles</span><span class="token punctuation">:</span>
    <span class="token key atrule">walkers_lane_change</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token number">0.0</span>
    <span class="token punctuation">-</span> <span class="token number">90.0</span>
    <span class="token key atrule">walkers_same_lane</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token number">0.0</span>
    <span class="token punctuation">-</span> <span class="token number">60.0</span>
    <span class="token key atrule">cars_lane_change</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token number">0.0</span>
    <span class="token punctuation">-</span> <span class="token number">180.0</span>
    <span class="token key atrule">cars_same_lane</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token number">0.0</span>
    <span class="token punctuation">-</span> <span class="token number">30.0</span>
    <span class="token key atrule">walkers_angle_adjust_chance</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
    <span class="token key atrule">walkers_adjust_angle</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token number">20.0</span>
    <span class="token punctuation">-</span> <span class="token number">-20.0</span>
    <span class="token key atrule">cars_angle_adjust_chance</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
    <span class="token key atrule">cars_adjust_angle</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token number">20.0</span>
    <span class="token punctuation">-</span> <span class="token number">-50.0</span>

  <span class="token comment"># For performance filters out vehicles that are further away than this distance in meters</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Info:</span>
  <span class="token comment">#     These vehicles are stored in `vehicles_nearby`.</span>
  <span class="token key atrule">nearby_vehicles_max_distance</span><span class="token punctuation">:</span> <span class="token number">45.0</span>

  <span class="token comment"># For performance filters out pedestrians that are further away than this distance in meters</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Info:</span>
  <span class="token comment">#     These pedestrians are stored in `walkers_nearby`.</span>
  <span class="token key atrule">nearby_walkers_max_distance</span><span class="token punctuation">:</span> <span class="token number">10.0</span>

  <span class="token comment"># When making lane changes determines the minimum distance to check for vehicles.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># max_distance_check = max(obstacles.min_proximity_threshold, </span>
  <span class="token comment">#                          live_info.current_speed_limit / speed_detection_downscale)</span>
  <span class="token comment">#                          </span>
  <span class="token comment"># Hint:</span>
  <span class="token comment">#     Lower values mean that further away vehicles are maybe not considered,</span>
  <span class="token comment">#     an agent might ignore fast vehicles coming from behind in the other lane,</span>
  <span class="token comment">#     or ignores slower vehicles in front of it in the other lane.</span>
  <span class="token key atrule">min_proximity_threshold</span><span class="token punctuation">:</span> <span class="token number">10.0</span>

  <span class="token comment"># When making lane changes determines the maximum distance to check for vehicles.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># max_distance_check = max(obstacles.min_proximity_threshold, </span>
  <span class="token comment">#                          live_info.current_speed_limit / speed_detection_downscale.[same|other]_lane)</span>
  <span class="token comment">#                          </span>
  <span class="token comment"># Hint:</span>
  <span class="token comment">#     Higher values mean that further away vehicles are not considered,</span>
  <span class="token comment">#     an agent might ignore fast vehicles coming from behind in the other lane,</span>
  <span class="token comment">#     or ignores slower vehicles in front of it in the other lane.</span>
  <span class="token key atrule">speed_detection_downscale</span><span class="token punctuation">:</span>
    <span class="token key atrule">same_lane</span><span class="token punctuation">:</span> <span class="token number">3.0</span>
    <span class="token key atrule">other_lane</span><span class="token punctuation">:</span> <span class="token number">2.0</span>
    <span class="token key atrule">overtaking</span><span class="token punctuation">:</span> <span class="token number">1.5</span>
    <span class="token key atrule">tailgating</span><span class="token punctuation">:</span> <span class="token number">2.0</span>
  <span class="token comment"># Percentage of time to ignore traffic lights</span>
  <span class="token key atrule">ignore_lights_percentage</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token comment"># Percentage of time to ignore stop signs</span>
  <span class="token key atrule">ignore_signs_percentage</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token comment"># Percentage of time to ignore pedestrians</span>
  <span class="token key atrule">ignore_walkers_percentage</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token comment"># For performance filters out pedestrians that are further away than this distance in meters</span>
  <span class="token key atrule">nearby_statics_max_distance</span><span class="token punctuation">:</span> <span class="token number">60.0</span>

  <span class="token comment"># Base distance to vehicles to check if they affect the vehicle</span>
  <span class="token comment">#         </span>
  <span class="token comment"># Usage: </span>
  <span class="token comment">#     static_detection_speed_ratio = base_static_threshold + static_detection_speed_ratio * vehicle_speed</span>
  <span class="token key atrule">base_static_threshold</span><span class="token punctuation">:</span> <span class="token number">2.0</span>

  <span class="token comment"># Usage: </span>
  <span class="token comment">#     static_detection_speed_ratio = base_static_threshold + static_detection_speed_ratio * vehicle_speed</span>
  <span class="token key atrule">static_detection_speed_ratio</span><span class="token punctuation">:</span> <span class="token number">0.5</span>


<span class="token comment"># Limitations of the controls used one the PIDController Level</span>
<span class="token key atrule">controls</span><span class="token punctuation">:</span>

  <span class="token comment"># Vehicle control how strong the brake is used, </span>
  <span class="token comment">#  </span>
  <span class="token comment"># NOTE: Also used in emergency stop</span>
  <span class="token key atrule">max_brake</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
  <span class="token comment"># maximum throttle applied to the vehicle</span>
  <span class="token key atrule">max_throttle</span><span class="token punctuation">:</span> <span class="token number">0.75</span>
  <span class="token comment"># maximum steering applied to the vehicle</span>
  <span class="token key atrule">max_steering</span><span class="token punctuation">:</span> <span class="token number">0.8</span>

  <span class="token comment"># Sets a lane offset displacement from the center line. Positive values imply a right offset while negative ones mean a left one.</span>
  <span class="token comment"># Default is 0. Numbers high enough to cause the vehicle to drive through other lanes might break the controller.</span>
  <span class="token key atrule">vehicle_lane_offset</span><span class="token punctuation">:</span> <span class="token number">0.0</span>


<span class="token comment"># PID controller using the following semantics:</span>
<span class="token comment">#         K_P -- Proportional term</span>
<span class="token comment">#         K_D -- Differential term</span>
<span class="token comment">#         K_I -- Integral term</span>
<span class="token comment">#         dt -- time differential in seconds</span>
<span class="token comment"># offset: If different than zero, the vehicle will drive displaced from the center line.</span>
<span class="token comment"># Positive values imply a right offset while negative ones mean a left one. </span>
<span class="token comment"># Numbers high enough to cause the vehicle to drive through other lanes might break the controller.</span>
<span class="token comment">#  </span>
<span class="token comment"># Notes:</span>
<span class="token comment"># `sampling_resolution` is used by the global planner to build a graph of road segments, also to get a path of waypoints from A to B</span>
<span class="token comment">#  </span>
<span class="token comment"># `sampling_radius` is similar but only used only by the local_planner to compute the next waypoints forward. The distance of those is the sampling_radius.</span>
<span class="token key atrule">planner</span><span class="token punctuation">:</span>

  <span class="token comment"># time differential in seconds</span>
  <span class="token comment">#  </span>
  <span class="token comment"># NOTE: Should set from main script.</span>
  <span class="token key atrule">dt</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>
  <span class="token comment"># values of the lateral PID controller</span>
  <span class="token key atrule">lateral_control_dict</span><span class="token punctuation">:</span>
    <span class="token key atrule">K_P</span><span class="token punctuation">:</span> <span class="token number">1.95</span>
    <span class="token key atrule">K_D</span><span class="token punctuation">:</span> <span class="token number">0.2</span>
    <span class="token key atrule">K_I</span><span class="token punctuation">:</span> <span class="token number">0.05</span>
    <span class="token key atrule">dt</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>$<span class="token punctuation">{</span>..dt<span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token comment"># values of the longitudinal PID controller</span>
  <span class="token key atrule">longitudinal_control_dict</span><span class="token punctuation">:</span>
    <span class="token key atrule">K_P</span><span class="token punctuation">:</span> <span class="token number">1.0</span>
    <span class="token key atrule">K_D</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
    <span class="token key atrule">K_I</span><span class="token punctuation">:</span> <span class="token number">0.05</span>
    <span class="token key atrule">dt</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>$<span class="token punctuation">{</span>..dt<span class="token punctuation">}</span><span class="token punctuation">}</span>

  <span class="token comment"># If different than zero, the vehicle will drive displaced from the center line.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Positive values imply a right offset while negative ones mean a left one. Numbers high enough</span>
  <span class="token comment"># to cause the vehicle to drive through other lanes might break the controller.</span>
  <span class="token key atrule">offset</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>controls.vehicle_lane_offset<span class="token punctuation">}</span>

  <span class="token comment"># Distance between waypoints when planning a path in `local_planner._compute_next_waypoints`</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Used with Waypoint.next(sampling_radius)</span>
  <span class="token key atrule">sampling_radius</span><span class="token punctuation">:</span> <span class="token number">2.0</span>

  <span class="token comment"># Distance between waypoints in `BasicAgent._generate_lane_change_path`</span>
  <span class="token comment"># and GlobalRoutePlanner to build the topology and path planning.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Used with the Waypoint.next(sampling_radius)</span>
  <span class="token key atrule">sampling_resolution</span><span class="token punctuation">:</span> <span class="token number">4.5</span>

  <span class="token comment"># Removes waypoints from the queue that are too close to the vehicle.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Usage: min_distance = min_distance_next_waypoint + next_waypoint_distance_ratio * vehicle_speed </span>
  <span class="token key atrule">min_distance_next_waypoint</span><span class="token punctuation">:</span> <span class="token number">3.0</span>
  <span class="token comment"># Increases the minimum distance to the next waypoint based on the vehicles speed.</span>
  <span class="token key atrule">next_waypoint_distance_ratio</span><span class="token punctuation">:</span> <span class="token number">0.5</span>

<span class="token key atrule">emergency</span><span class="token punctuation">:</span>
  <span class="token key atrule">throttle</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token key atrule">max_emergency_brake</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>controls.max_brake<span class="token punctuation">}</span>
  <span class="token key atrule">hand_brake</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># Percentage of time to ignore an emergency situation and proceed as normal</span>
  <span class="token key atrule">ignore_percentage</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token comment"># Chance to choose the opposite of hand_break</span>
  <span class="token key atrule">hand_brake_modify_chance</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
  <span class="token comment"># Whether to do random steering</span>
  <span class="token key atrule">do_random_steering</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># Range of random steering that is applied</span>
  <span class="token key atrule">random_steering_range</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token number">-0.25</span>
  <span class="token punctuation">-</span> <span class="token number">0.25</span>

<span class="token key atrule">rss</span><span class="token punctuation">:</span>

  <span class="token comment"># Use the RSS sensor.</span>
  <span class="token comment">#  </span>
  <span class="token comment"># NOTE: Initializing with False and changing it to True is not supported.</span>
  <span class="token comment"># If RSS is not available (no ad-rss library) this will be set to False.</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">use_stay_on_road_feature</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">log_level</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token comment"># Sets the visualization mode that should be rendered on the screen.</span>
  <span class="token key atrule">debug_visualization_mode</span><span class="token punctuation">:</span> RouteOnly
  <span class="token comment"># Setting for the default rule to always accept RSS updates if they are valid</span>
  <span class="token key atrule">always_accept_update</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># For fast vehicles RSS currently is unreliable, disables rss updates when the vehicle is faster than this.</span>
  <span class="token key atrule">rss_max_speed</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span><span class="token punctuation">?</span>

<span class="token key atrule">detection_matrix</span><span class="token punctuation">:</span>
  <span class="token comment"># Activate or deactivate the detection matrix</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token comment"># When the world uses synchronous mode and sync is true, the data matrix will be updated every sync_interval ticks.</span>
  <span class="token comment"># A low value will have a negative impact on the fps.</span>
  <span class="token comment"># If the world uses asynchronous mode or sync is False the data matrix will be updated by a different thread.</span>
  <span class="token comment"># This increases the fps but updates will be less frequent.</span>
  <span class="token key atrule">sync</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># The interval in frames after which the data matrix should be updated. Sync must be true.</span>
  <span class="token key atrule">sync_interval</span><span class="token punctuation">:</span> <span class="token number">5</span>

  <span class="token comment"># TODO: do not have this in Agent config; instead</span>
  <span class="token comment">#     hud : ${camera.hud.detection_matrix}</span>
  <span class="token comment">#     However: problem cannot interpolate to LaunchConfig</span>
  <span class="token comment">#  #drawing_options -&gt; see camera.yaml</span>
  <span class="token comment">#  </span>
  <span class="token comment"># ---</span>
  <span class="token comment">#     </span>
  <span class="token comment"># Keyword arguments for `DetectionMatrix.render`</span>
  <span class="token comment">#  </span>
  <span class="token comment"># Warning:</span>
  <span class="token comment">#     `camera.hud.detection_matrix` is preferred.</span>
  <span class="token key atrule">hud</span><span class="token punctuation">:</span>
    <span class="token key atrule">draw</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">values</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">vertical</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">imshow_settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">cmap</span><span class="token punctuation">:</span> jet
    <span class="token key atrule">text_settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">color</span><span class="token punctuation">:</span> orange
</code></pre></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li class="invisable-node"><ul class="nav">
<li><a href="#Table-of-Contents" title="Table of Contents">Table of Contents</a></li>
</ul>
</li>
<li><a href="#Introduction" title="Introduction">Introduction</a><ul class="nav">
<li><a href="#Installation" title="Installation">Installation</a></li>
<li><a href="#Quickstart" title="Quickstart">Quickstart</a></li>
<li><a href="#External-Setup-Using-the-ScenarioRunner-and-other-Initializations" title="External Setup: Using the ScenarioRunner and other Initializations">External Setup: Using the ScenarioRunner and other Initializations</a></li>
</ul>
</li>
<li><a href="#Agent-Classes" title="Agent Classes">Agent Classes</a><ul class="nav">
<li><a href="#Creation" title="Creation">Creation</a><ul class="nav">
<li><a href="#LunaticChallenger" title="LunaticChallenger">LunaticChallenger</a></li>
<li><a href="#LunaticAgent" title="LunaticAgent">LunaticAgent</a></li>
</ul>
</li>
<li><a href="#Workflow" title="Workflow">Workflow</a></li>
<li><a href="#Phases" title="Phases">Phases</a><ul class="nav">
<li><a href="#Definition" title="Definition">Definition</a></li>
<li><a href="#Emergency-Phase" title="Emergency Phase">Emergency Phase</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Rules" title="Rules">Rules</a><ul class="nav">
<li><a href="#Evaluation-Function" title="Evaluation Function">Evaluation Function</a><ul class="nav">
<li><a href="#Registering-Actions" title="Registering Actions">Registering Actions</a></li>
</ul>
</li>
<li><a href="#Rule-Classes-and-Features" title="Rule Classes and Features">Rule Classes and Features</a><ul class="nav">
<li><a href="#Functional-API" title="Functional API">Functional API</a></li>
<li><a href="#Class-API" title="Class API">Class API</a></li>
<li><a href="#MultiRule-Class" title="MultiRule Class">MultiRule Class</a></li>
<li><a href="#RandomRule-Class" title="RandomRule Class:">RandomRule Class:</a></li>
<li><a href="#Cooldown-and-Group-Management" title="Cooldown and Group Management">Cooldown and Group Management</a></li>
<li><a href="#Duplicating-a-Rule" title="Duplicating a Rule">Duplicating a Rule</a></li>
<li><a href="#Rule-and-Action-Functions" title="Rule and Action Functions">Rule and Action Functions</a></li>
</ul>
</li>
<li><a href="#Creating-New-Rule-Metaclass" title="Creating New Rule Metaclass">Creating New Rule Metaclass</a></li>
<li><a href="#Adding-Rules-to-Agent" title="Adding Rules to Agent">Adding Rules to Agent</a></li>
</ul>
</li>
<li><a href="#Context-Object" title="Context Object">Context Object</a><ul class="nav">
<li><a href="#Attributes" title="Attributes:">Attributes:</a></li>
</ul>
</li>
<li><a href="#Configuration-and-Hydra-Framework" title="Configuration and Hydra Framework">Configuration and Hydra Framework</a><ul class="nav">
<li><a href="#Launching-Customized-Experiments" title="Launching Customized Experiments">Launching Customized Experiments</a><ul class="nav">
<li><a href="#Explaination" title="Explaination">Explaination</a></li>
</ul>
</li>
<li><a href="#Hydra-Framework" title="Hydra Framework">Hydra Framework</a></li>
<li><a href="#Config-Hierarchy" title="Config Hierarchy">Config Hierarchy</a><ul class="nav">
<li><a href="#LaunchConfig" title="LaunchConfig">LaunchConfig</a></li>
<li><a href="#AgentConfig" title="AgentConfig">AgentConfig</a></li>
<li><a href="#Type-checking-and-Type-forcing" title="Type-checking and Type-forcing">Type-checking and Type-forcing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Further-Modules" title="Further Modules">Further Modules</a><ul class="nav">
<li><a href="#GameFramework" title="GameFramework">GameFramework</a></li>
<li><a href="#WorldModel" title="WorldModel">WorldModel</a></li>
<li><a href="#Information-Gathering" title="Information Gathering">Information Gathering</a><ul class="nav">
<li><a href="#CarlaDataProvider" title="CarlaDataProvider">CarlaDataProvider</a></li>
<li><a href="#Information-Manager" title="Information Manager">Information Manager</a></li>
<li><a href="#Detection-Matrix" title="Detection Matrix">Detection Matrix</a></li>
</ul>
</li>
<li><a href="#Responsibility-Sensitive-Safety-RSS" title="Responsibility Sensitive Safety (RSS)">Responsibility Sensitive Safety (RSS)</a><ul class="nav">
<li><a href="#Integration" title="Integration">Integration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Future-Work" title="Future Work">Future Work</a></li>
<li><a href="#Appendix" title="Appendix">Appendix</a><ul class="nav">
<li><a href="#Hazard-Enumeration" title="Hazard Enumeration">Hazard Enumeration</a><ul class="nav">
<li><a href="#Types-and-Severity-Levels" title="Types and Severity Levels">Types and Severity Levels</a></li>
</ul>
</li>
<li><a href="#Keyboard-Controls" title="Keyboard Controls">Keyboard Controls</a></li>
<li><a href="#Troubleshooting" title="Troubleshooting">Troubleshooting</a><ul class="nav">
<li><a href="#RSS-is-not-available-possible-solutions" title="RSS is not available; possible solutions">RSS is not available; possible solutions</a></li>
<li><a href="#BoostPythonArgumentError" title="Boost.Python.ArgumentError">Boost.Python.ArgumentError</a></li>
<li><a href="#GLIBCXX_3430-not-found" title="`GLIBCXX_3.4.30' not found">`GLIBCXX_3.4.30' not found</a></li>
</ul>
</li>
<li><a href="#Config-Settings" title="Config Settings:">Config Settings:</a><ul class="nav">
<li><a href="#Example-of-the-LaunchConfig" title="Example of the LaunchConfig">Example of the LaunchConfig</a></li>
<li><a href="#Example-of-full-Agent-Settings" title="Example of full Agent Settings">Example of full Agent Settings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav">
<li class="invisable-node"><ul class="nav">
<li><a href="#Table-of-Contents" title="Table of Contents">Table of Contents</a></li>
</ul>
</li>
<li><a href="#Introduction" title="Introduction">Introduction</a><ul class="nav">
<li><a href="#Installation" title="Installation">Installation</a></li>
<li><a href="#Quickstart" title="Quickstart">Quickstart</a></li>
<li><a href="#External-Setup-Using-the-ScenarioRunner-and-other-Initializations" title="External Setup: Using the ScenarioRunner and other Initializations">External Setup: Using the ScenarioRunner and other Initializations</a></li>
</ul>
</li>
<li><a href="#Agent-Classes" title="Agent Classes">Agent Classes</a><ul class="nav">
<li><a href="#Creation" title="Creation">Creation</a><ul class="nav">
<li><a href="#LunaticChallenger" title="LunaticChallenger">LunaticChallenger</a></li>
<li><a href="#LunaticAgent" title="LunaticAgent">LunaticAgent</a></li>
</ul>
</li>
<li><a href="#Workflow" title="Workflow">Workflow</a></li>
<li><a href="#Phases" title="Phases">Phases</a><ul class="nav">
<li><a href="#Definition" title="Definition">Definition</a></li>
<li><a href="#Emergency-Phase" title="Emergency Phase">Emergency Phase</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Rules" title="Rules">Rules</a><ul class="nav">
<li><a href="#Evaluation-Function" title="Evaluation Function">Evaluation Function</a><ul class="nav">
<li><a href="#Registering-Actions" title="Registering Actions">Registering Actions</a></li>
</ul>
</li>
<li><a href="#Rule-Classes-and-Features" title="Rule Classes and Features">Rule Classes and Features</a><ul class="nav">
<li><a href="#Functional-API" title="Functional API">Functional API</a></li>
<li><a href="#Class-API" title="Class API">Class API</a></li>
<li><a href="#MultiRule-Class" title="MultiRule Class">MultiRule Class</a></li>
<li><a href="#RandomRule-Class" title="RandomRule Class:">RandomRule Class:</a></li>
<li><a href="#Cooldown-and-Group-Management" title="Cooldown and Group Management">Cooldown and Group Management</a></li>
<li><a href="#Duplicating-a-Rule" title="Duplicating a Rule">Duplicating a Rule</a></li>
<li><a href="#Rule-and-Action-Functions" title="Rule and Action Functions">Rule and Action Functions</a></li>
</ul>
</li>
<li><a href="#Creating-New-Rule-Metaclass" title="Creating New Rule Metaclass">Creating New Rule Metaclass</a></li>
<li><a href="#Adding-Rules-to-Agent" title="Adding Rules to Agent">Adding Rules to Agent</a></li>
</ul>
</li>
<li><a href="#Context-Object" title="Context Object">Context Object</a><ul class="nav">
<li><a href="#Attributes" title="Attributes:">Attributes:</a></li>
</ul>
</li>
<li><a href="#Configuration-and-Hydra-Framework" title="Configuration and Hydra Framework">Configuration and Hydra Framework</a><ul class="nav">
<li><a href="#Launching-Customized-Experiments" title="Launching Customized Experiments">Launching Customized Experiments</a><ul class="nav">
<li><a href="#Explaination" title="Explaination">Explaination</a></li>
</ul>
</li>
<li><a href="#Hydra-Framework" title="Hydra Framework">Hydra Framework</a></li>
<li><a href="#Config-Hierarchy" title="Config Hierarchy">Config Hierarchy</a><ul class="nav">
<li><a href="#LaunchConfig" title="LaunchConfig">LaunchConfig</a></li>
<li><a href="#AgentConfig" title="AgentConfig">AgentConfig</a></li>
<li><a href="#Type-checking-and-Type-forcing" title="Type-checking and Type-forcing">Type-checking and Type-forcing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Further-Modules" title="Further Modules">Further Modules</a><ul class="nav">
<li><a href="#GameFramework" title="GameFramework">GameFramework</a></li>
<li><a href="#WorldModel" title="WorldModel">WorldModel</a></li>
<li><a href="#Information-Gathering" title="Information Gathering">Information Gathering</a><ul class="nav">
<li><a href="#CarlaDataProvider" title="CarlaDataProvider">CarlaDataProvider</a></li>
<li><a href="#Information-Manager" title="Information Manager">Information Manager</a></li>
<li><a href="#Detection-Matrix" title="Detection Matrix">Detection Matrix</a></li>
</ul>
</li>
<li><a href="#Responsibility-Sensitive-Safety-RSS" title="Responsibility Sensitive Safety (RSS)">Responsibility Sensitive Safety (RSS)</a><ul class="nav">
<li><a href="#Integration" title="Integration">Integration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Future-Work" title="Future Work">Future Work</a></li>
<li><a href="#Appendix" title="Appendix">Appendix</a><ul class="nav">
<li><a href="#Hazard-Enumeration" title="Hazard Enumeration">Hazard Enumeration</a><ul class="nav">
<li><a href="#Types-and-Severity-Levels" title="Types and Severity Levels">Types and Severity Levels</a></li>
</ul>
</li>
<li><a href="#Keyboard-Controls" title="Keyboard Controls">Keyboard Controls</a></li>
<li><a href="#Troubleshooting" title="Troubleshooting">Troubleshooting</a><ul class="nav">
<li><a href="#RSS-is-not-available-possible-solutions" title="RSS is not available; possible solutions">RSS is not available; possible solutions</a></li>
<li><a href="#BoostPythonArgumentError" title="Boost.Python.ArgumentError">Boost.Python.ArgumentError</a></li>
<li><a href="#GLIBCXX_3430-not-found" title="`GLIBCXX_3.4.30' not found">`GLIBCXX_3.4.30' not found</a></li>
</ul>
</li>
<li><a href="#Config-Settings" title="Config Settings:">Config Settings:</a><ul class="nav">
<li><a href="#Example-of-the-LaunchConfig" title="Example of the LaunchConfig">Example of the LaunchConfig</a></li>
<li><a href="#Example-of-full-Agent-Settings" title="Example of full Agent Settings">Example of full Agent Settings</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>